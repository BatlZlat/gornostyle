# ะกะฒะพะดะบะฐ ะฟะพ ัะธััะตะผะต ัะฒะตะดะพะผะปะตะฝะธะน

## ๐ ะงัะพ ะฑัะปะพ ัะพะทะดะฐะฝะพ

### 1. ะัะฝะพะฒะฝัะต ะบะพะผะฟะพะฝะตะฝัั

#### โ ะกะตัะฒะธั ัะฒะตะดะพะผะปะตะฝะธะน
**ะคะฐะนะป:** `src/services/notification-service.js`
- ะะพะปััะตะฝะธะต ััะตะฝะธัะพะฒะพะบ ะฝะฐ ัะบะฐะทะฐะฝะฝัั ะดะฐัั
- ะััะฟะฟะธัะพะฒะบะฐ ะฟะพ ะบะปะธะตะฝัะฐะผ (ะพะดะธะฝ ะบะปะธะตะฝั = ะพะดะฝะพ ัะฒะตะดะพะผะปะตะฝะธะต)
- ะคะพัะผะธัะพะฒะฐะฝะธะต ะบัะฐัะธะฒัั ัะพะพะฑัะตะฝะธะน
- ะัะฟัะฐะฒะบะฐ ัะตัะตะท Telegram Bot API
- ะะพะณะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ

#### โ ะะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐั
**ะคะฐะนะป:** `src/services/scheduler.js`
- ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ ะฒ 21:00 ะบะฐะถะดัะน ะดะตะฝั
- ะัะฟะพะปัะทัะตั node-cron ั timezone Asia/Yekaterinburg
- ะะฝัะตะณัะธัะพะฒะฐะฝ ะฒ ะพัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต

#### โ ะกะบัะธะฟั ะพัะฟัะฐะฒะบะธ
**ะคะฐะนะป:** `src/scripts/send-training-reminders.js`
- ะะพะฝัะพะปัะฝัะน ัะบัะธะฟั ะดะปั ัััะฝะพะน ะพัะฟัะฐะฒะบะธ
- ะะพะดะดะตัะถะบะฐ ะฟัะพะธะทะฒะพะปัะฝัั ะดะฐั
- ะะตัะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ
- ะฃะฒะตะดะพะผะปะตะฝะธั ะฐะดะผะธะฝะธัััะฐัะพัั

#### โ ะขะตััะพะฒัะน ัะบัะธะฟั
**ะคะฐะนะป:** `src/scripts/test-notifications.js`
- ะะตะถะธะผ dry-run (ะฑะตะท ัะตะฐะปัะฝะพะน ะพัะฟัะฐะฒะบะธ)
- ะัะพัะผะพัั ัะพัะผะธััะตะผัั ัะพะพะฑัะตะฝะธะน
- ะัะพะฒะตัะบะฐ ะณััะฟะฟะธัะพะฒะบะธ
- ะัะปะฐะดะบะฐ ะฟะตัะตะด ะทะฐะฟััะบะพะผ

### 2. ะะฐะทะฐ ะดะฐะฝะฝัั

#### โ ะะธะณัะฐัะธั
**ะคะฐะนะป:** `migrations/012_add_notification_logs.sql`
- ะขะฐะฑะปะธัะฐ notification_logs ะดะปั ะปะพะณะธัะพะฒะฐะฝะธั
- ะะฝะดะตะบัั ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ
- ะะพะผะผะตะฝัะฐัะธะธ ะบ ะฟะพะปัะผ

### 3. ะะพะบัะผะตะฝัะฐัะธั

#### โ ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
**ะคะฐะนะป:** `docs/notification-system.md`
- ะััะธัะตะบัััะฐ ัะธััะตะผั
- ะะฟะธัะฐะฝะธะต ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ
- ะัะธะผะตัั ัะพะพะฑัะตะฝะธะน
- ะะพะฝะธัะพัะธะฝะณ ะธ ััััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ
- SQL-ะทะฐะฟัะพัั ะดะปั ะฐะฝะฐะปะธะทะฐ

#### โ ะะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต
**ะคะฐะนะป:** `docs/notification-setup-guide.md`
- ะะพัะฐะณะพะฒะฐั ะธะฝััััะบัะธั
- ะะพะผะฐะฝะดั ะดะปั ัะตััะธัะพะฒะฐะฝะธั
- ะัะพะฒะตัะบะฐ ัะฐะฑะพัั
- ะะตัะตะฝะธะต ัะธะฟะธัะฝัั ะฟัะพะฑะปะตะผ

### 4. ะะฝัะตะณัะฐัะธั

#### โ ะะทะผะตะฝะตะฝะธั ะฒ app.js
**ะคะฐะนะป:** `src/app.js` (ัััะพะบะธ 29, 38-39)
```javascript
const scheduler = require('./services/scheduler');
// ...
scheduler.init();
```

## ๐ฏ ะัะฝะพะฒะฝัะต ะพัะพะฑะตะฝะฝะพััะธ

### 1. ะฃะผะฝะฐั ะณััะฟะฟะธัะพะฒะบะฐ
ะัะปะธ ั ะบะปะธะตะฝัะฐ ะทะฐะฟะธัะฐะฝั 2 ัะตะฑะตะฝะบะฐ ะฝะฐ ััะตะฝะธัะพะฒะบะธ, ะพัะฟัะฐะฒะปัะตััั **ะพะดะฝะพ ัะฒะพะดะฝะพะต ัะพะพะฑัะตะฝะธะต**, ะฐ ะฝะต ะดะฒะฐ ะพัะดะตะปัะฝัั.

### 2. ะะพะดะดะตัะถะบะฐ ะฒัะตั ัะธะฟะพะฒ ััะตะฝะธัะพะฒะพะบ
- โ ะััะฟะฟะพะฒัะต ััะตะฝะธัะพะฒะบะธ
- โ ะะฝะดะธะฒะธะดัะฐะปัะฝัะต ััะตะฝะธัะพะฒะบะธ
- โ ะก ััะตะฝะตัะพะผ ะธ ะฑะตะท

### 3. ะะฒัะพะผะฐัะธะทะฐัะธั
- โฐ ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะฟัะฐะฒะบะฐ ะฒ 21:00 ะฟะพ ะะบะฐัะตัะธะฝะฑััะณั
- ๐ ะะพะปะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพัะฟัะฐะฒะพะบ
- ๐ ะกัะฐัะธััะธะบะฐ ะธ ะพััะตัั

### 4. ะะฝัะพัะผะฐัะธะฒะฝะพััั
ะะฐะถะดะพะต ัะฒะตะดะพะผะปะตะฝะธะต ัะพะดะตัะถะธั:
- ๐ ะะฐัั ะธ ะฒัะตะผั ััะตะฝะธัะพะฒะบะธ
- ๐ค ะะผั ััะฐััะฝะธะบะฐ (ะฒะทัะพัะปัะน/ัะตะฑะตะฝะพะบ)
- ๐ ะขะธะฟ ััะตะฝะธัะพะฒะบะธ
- โท ะะธะด ัะฝะฐััะถะตะฝะธั
- ๐ ะะฐะทะฒะฐะฝะธะต ััะตะฝะฐะถะตัะฐ
- ๐จโ๐ซ ะะผั ััะตะฝะตัะฐ
- ๐ ะฃัะพะฒะตะฝั ัะปะพะถะฝะพััะธ (ะดะปั ะณััะฟะฟะพะฒัั)

### 5. ะะพะปะตะทะฝะฐั ะธะฝัะพัะผะฐัะธั
> ะะดะตะผ ะฒะฐั! ะัะธะตะทะถะฐะนัะต ะฝะฐ ััะตะฝะธัะพะฒะบั ะทะฐ 10-15 ะผะธะฝัั ะดะพ ะฝะฐัะฐะปะฐ. 
> ะะต ะทะฐะฑัะดััะต ะฒะทััั ั ัะพะฑะพะน ะฒะพะดั ะธ ะพะดะตะถะดั, ะถะตะปะฐัะตะปัะฝะพ ะทะฐะบััะฒะฐัััั ะบะพะปะตะฝะธ ะธ ะปะพะบัะธ ๐

## ๐ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั

### ะะฒัะพะผะฐัะธัะตัะบะธะน ัะตะถะธะผ (ัะตะบะพะผะตะฝะดัะตััั)

1. **ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธั:**
```bash
psql -U postgres -d your_database -f migrations/012_add_notification_logs.sql
```

2. **ะะตัะตะทะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต:**
```bash
pm2 restart gornostyle
```

3. **ะะพัะพะฒะพ!** ะกะธััะตะผะฐ ะฑัะดะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะฟัะฐะฒะปััั ัะฒะตะดะพะผะปะตะฝะธั ะบะฐะถะดัะน ะดะตะฝั ะฒ 21:00.

### ะััะฝะพะน ัะตะถะธะผ (ะดะปั ัะตััะธัะพะฒะฐะฝะธั)

```bash
# ะขะตััะพะฒัะน ะทะฐะฟััะบ (ะฑะตะท ะพัะฟัะฐะฒะบะธ)
node src/scripts/test-notifications.js --dry-run

# ะะตะฐะปัะฝะฐั ะพัะฟัะฐะฒะบะฐ ะฝะฐ ะทะฐะฒััะฐ
node src/scripts/send-training-reminders.js

# ะัะฟัะฐะฒะบะฐ ะฝะฐ ะบะพะฝะบัะตัะฝัั ะดะฐัั
node src/scripts/send-training-reminders.js 2025-10-15
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ััะฐัะธััะธะบะธ

```sql
-- ะกัะฐัะธััะธะบะฐ ะทะฐ ะฟะพัะปะตะดะฝัั ะฝะตะดะตะปั
SELECT 
    DATE(sent_at) as date,
    COUNT(*) as total,
    SUM(CASE WHEN status = 'sent' THEN 1 ELSE 0 END) as sent,
    SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed
FROM notification_logs
WHERE notification_type = 'training_reminder'
  AND sent_at >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY DATE(sent_at)
ORDER BY date DESC;
```

### ะัะพะฒะตัะบะฐ ะฟะพัะปะตะดะฝะธั ะพัะฟัะฐะฒะพะบ

```sql
SELECT 
    nl.sent_at,
    c.full_name,
    nl.training_date,
    nl.status
FROM notification_logs nl
JOIN clients c ON nl.client_id = c.id
ORDER BY nl.sent_at DESC
LIMIT 10;
```

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
gornostyle/
โโโ src/
โ   โโโ services/
โ   โ   โโโ notification-service.js    [ะะะะซะ] ะัะฝะพะฒะฝะพะน ัะตัะฒะธั
โ   โ   โโโ scheduler.js                [ะะะะซะ] ะะปะฐะฝะธัะพะฒัะธะบ ะทะฐะดะฐั
โ   โโโ scripts/
โ   โ   โโโ send-training-reminders.js [ะะะะซะ] ะกะบัะธะฟั ะพัะฟัะฐะฒะบะธ
โ   โ   โโโ test-notifications.js      [ะะะะซะ] ะขะตััะพะฒัะน ัะบัะธะฟั
โ   โโโ app.js                          [ะะะะะะะ] ะะพะฑะฐะฒะปะตะฝ ะทะฐะฟััะบ ะฟะปะฐะฝะธัะพะฒัะธะบะฐ
โโโ migrations/
โ   โโโ 012_add_notification_logs.sql  [ะะะะซะ] ะะธะณัะฐัะธั ะะ
โโโ docs/
โ   โโโ notification-system.md         [ะะะะซะ] ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
โ   โโโ notification-setup-guide.md    [ะะะะซะ] ะะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต
โโโ NOTIFICATION_SYSTEM_SUMMARY.md     [ะะะะซะ] ะญัะฐ ัะฒะพะดะบะฐ
```

## โ ะงะตะบ-ะปะธัั ัััะฐะฝะพะฒะบะธ

- [ ] ะัะธะผะตะฝะตะฝะฐ ะผะธะณัะฐัะธั `012_add_notification_logs.sql`
- [ ] ะัะพะฒะตัะตะฝ `.env` (ะฝะฐะปะธัะธะต TELEGRAM_BOT_TOKEN)
- [ ] ะะฐะฟััะตะฝ ัะตัั: `node src/scripts/test-notifications.js --dry-run`
- [ ] ะะตัะตะทะฐะฟััะตะฝะพ ะฟัะธะปะพะถะตะฝะธะต
- [ ] ะัะพะฒะตัะตะฝั ะปะพะณะธ ะฟัะธะปะพะถะตะฝะธั
- [ ] ะะพะถะดะฐัััั ะฟะตัะฒะพะน ะพัะฟัะฐะฒะบะธ ะฒ 21:00 ะธะปะธ ะทะฐะฟัััะธัั ะฒัััะฝัั

## ๐ง ะขัะตะฑะพะฒะฐะฝะธั

- โ Node.js ั ะฟะฐะบะตัะพะผ `node-cron` (ัะถะต ัััะฐะฝะพะฒะปะตะฝ)
- โ PostgreSQL ั ัััะตััะฒัััะธะผะธ ัะฐะฑะปะธัะฐะผะธ
- โ Telegram Bot Token ะฒ .env
- โ ะฃ ะบะปะธะตะฝัะพะฒ ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟะพะปะฝะตะฝ telegram_id

## ๐ ะะตะทัะปััะฐั

ะขะตะฟะตัั ะฒะฐัะธ ะบะปะธะตะฝัั ะฑัะดัั ะฟะพะปััะฐัั ะบัะฐัะธะฒัะต ะธ ะธะฝัะพัะผะฐัะธะฒะฝัะต ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฟัะตะดััะพััะธั ััะตะฝะธัะพะฒะบะฐั ะบะฐะถะดัะน ะดะตะฝั ะฒ 21:00!

### ะัะธะผะตั ัะฒะตะดะพะผะปะตะฝะธั:

```
๐ ะะฐะฟะพะผะธะฝะฐะฝะธะต ะพ ััะตะฝะธัะพะฒะบะฐั!

ะะฐะฒััะฐ, 10 ะพะบััะฑัั:

๐ 10:00 - 11:00
๐ค ะฃัะฐััะฝะธะบ: ะะฒะฐะฝ ะะตััะพะฒ (ัะตะฑะตะฝะพะบ)
๐ ะขะธะฟ: ะััะฟะฟะพะฒะฐั ััะตะฝะธัะพะฒะบะฐ
โท ะกะฝะฐััะถะตะฝะธะต: ะัะถะธ
๐ ะขัะตะฝะฐะถะตั: Slope Simulator 1
๐จโ๐ซ ะขัะตะฝะตั: ะะปะตะบัะตะน ะกะผะธัะฝะพะฒ
๐ ะฃัะพะฒะตะฝั: 3

โโโโโโโโโโโโโโโโโโโโ

๐ 14:00 - 15:00
๐ค ะฃัะฐััะฝะธัะฐ: ะะฐัะธั ะะตััะพะฒะฐ (ัะตะฑะตะฝะพะบ)
๐ ะขะธะฟ: ะะฝะดะธะฒะธะดัะฐะปัะฝะฐั ััะตะฝะธัะพะฒะบะฐ
โท ะกะฝะฐััะถะตะฝะธะต: ะกะฝะพัะฑะพัะด
๐ ะขัะตะฝะฐะถะตั: Slope Simulator 2

โโโโโโโโโโโโโโโโโโโโ

ะะดะตะผ ะฒะฐั! ะัะธะตะทะถะฐะนัะต ะฝะฐ ััะตะฝะธัะพะฒะบั ะทะฐ 10-15 ะผะธะฝัั ะดะพ ะฝะฐัะฐะปะฐ. 
ะะต ะทะฐะฑัะดััะต ะฒะทััั ั ัะพะฑะพะน ะฒะพะดั ะธ ะพะดะตะถะดั, ะถะตะปะฐัะตะปัะฝะพ ะทะฐะบััะฒะฐัััั 
ะบะพะปะตะฝะธ ะธ ะปะพะบัะธ ๐
```

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะปะธ ะฒะพะทะฝะธะบะฝัั ะฒะพะฟัะพัั:
1. ะัะพะฒะตัััะต `docs/notification-system.md` (ะฟะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั)
2. ะัะพะฒะตัััะต `docs/notification-setup-guide.md` (ะธะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต)
3. ะะฐะฟัััะธัะต ัะตััะพะฒัะน ัะบัะธะฟั ั `--dry-run`
4. ะัะพะฒะตัััะต ัะฐะฑะปะธัั `notification_logs` ะฒ ะะ

---

**ะะตััะธั:** 1.0.0  
**ะะฐัะฐ:** 09.10.2025  
**ะกัะฐััั:** โ ะะพัะพะฒะพ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

