# Настройка Resend для отправки email уведомлений

## Обзор

Resend - это сервис для отправки транзакционных email. После настройки домена можно отправлять письма на любые адреса (включая mail.ru, yandex.ru и другие российские почтовые сервисы).

## Пошаговая инструкция

### Шаг 1: Регистрация/Вход в Resend

1. Откройте https://resend.com/
2. Войдите в аккаунт (или зарегистрируйтесь, если аккаунта нет)
3. Убедитесь, что у вас есть API ключ (он должен быть в `.env` файле)

### Шаг 2: Добавление домена

1. В панели Resend перейдите в раздел **"Domains"** (Домены)
2. Нажмите кнопку **"Add Domain"** (Добавить домен)
3. Введите ваш домен: `gornostyle72.ru` (без www, без http/https)
4. Нажмите **"Add"** (Добавить)

### Шаг 3: Настройка DNS записей

Resend покажет вам список DNS записей, которые нужно добавить. Обычно это:

#### 1. SPF запись (TXT)
```
Type: TXT
Name: @ (или просто оставить пустым, или gornostyle72.ru)
Value: v=spf1 include:resend.com ~all
TTL: 3600 (или Auto)
```

#### 2. DKIM записи (TXT) - обычно 3 записи
```
Type: TXT
Name: resend._domainkey (или подобное)
Value: [длинная строка, которую даст Resend]
TTL: 3600
```

Может быть несколько DKIM записей с разными именами (например, `resend._domainkey`, `resend1._domainkey`, `resend2._domainkey`).

#### 3. DMARC запись (опционально, но рекомендуется)
```
Type: TXT
Name: _dmarc
Value: v=DMARC1; p=none; rua=mailto:dmarc@gornostyle72.ru
TTL: 3600
```

### Шаг 4: Добавление DNS записей в панели управления доменом

1. Войдите в панель управления вашим доменом (где вы регистрировали домен `gornostyle72.ru`)
   - Это может быть регистратор домена (Reg.ru, Timeweb, и т.д.)
   - Или панель хостинга, если DNS управляется там

2. Найдите раздел **DNS** или **Zone файлы** или **Управление DNS**

3. Добавьте все записи, которые показал Resend:
   - **SPF запись** (TXT)
   - **Все DKIM записи** (TXT)
   - **DMARC запись** (TXT, опционально)

4. Сохраните изменения

### Шаг 5: Ожидание верификации

1. Вернитесь в панель Resend
2. Обновите страницу с доменами
3. Дождитесь верификации домена
   - Обычно это занимает **5-15 минут**
   - Иногда может занять до **48 часов** (если DNS медленно обновляется)
   - Статус должен измениться на **"Verified"** (Проверено) ✅

### Шаг 6: Обновление .env файла

После того, как домен верифицирован, обновите настройки в `.env` файле:

```bash
# Resend настройки (после верификации домена)
RESEND_API_KEY=re_HnskK3BW_4Ffo7i99zU9BoU954v3CJsA8
RESEND_FROM_EMAIL=noreply@gornostyle72.ru
RESEND_FROM_NAME=Горностайл72
```

**Важно:**
- `RESEND_FROM_EMAIL` должен быть адресом на вашем домене: `noreply@gornostyle72.ru` или `info@gornostyle72.ru`
- НЕ используйте `onboarding@resend.dev` - это только для тестирования
- Email адрес не обязательно должен существовать физически (почтовый ящик), но домен должен быть верифицирован

### Шаг 7: Перезапуск приложения

После обновления `.env` файла:

```bash
# На сервере
pm2 restart ecosystem.config.js
# или
npm run pm2:restart
```

### Шаг 8: Тестирование

Отправьте тестовое письмо через скрипт:

```bash
node scripts/send-booking-confirmation-email.js
```

Теперь письма должны отправляться через Resend на любые адреса, включая mail.ru!

## Что происходит сейчас

- **SMTP Yandex** - основной метод, работает для большинства адресов, но может таймаутить для mail.ru
- **Resend** - используется как fallback, когда SMTP не работает

После настройки домена Resend сможет отправлять на любые адреса, что решит проблему с mail.ru.

## Полезные ссылки

- Resend Dashboard: https://resend.com/domains
- Документация Resend: https://resend.com/docs
- Проверка DNS записей: https://mxtoolbox.com/ (можете проверить, правильно ли настроены записи)

## Примечания

- После настройки домена в Resend письма будут отправляться с адреса `noreply@gornostyle72.ru` (или другого указанного)
- Это улучшит доставляемость писем и их репутацию
- Можно использовать разные адреса для разных типов писем (noreply, info, support и т.д.)

