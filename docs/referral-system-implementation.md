# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ –±–æ—Ç–µ

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ü—Ä–∏–≤–µ–ª –∫–ª–∏–µ–Ω—Ç–∞ = –ø–æ–ª—É—á–∏–ª 500‚ÇΩ
2. **–í–∑–∞–∏–º–Ω–æ—Å—Ç—å**: –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç —Ç–æ–∂–µ –ø–æ–ª—É—á–∞–µ—Ç 500‚ÇΩ
3. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –í—Å–µ –±–æ–Ω—É—Å—ã –≤–∏–¥–Ω—ã –≤ –∫–æ—à–µ–ª—å–∫–µ
4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ë–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
```javascript
// –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
function generateReferralCode(clientId) {
    return `REF${clientId.toString().padStart(6, '0')}`;
}

// –ü—Ä–∏–º–µ—Ä: REF000123 –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å ID 123
```

### 2. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
```
–§–æ—Ä–º–∞—Ç: t.me/your_bot?start=ref_REF000123
–ü—Ä–∏–º–µ—Ä: t.me/gornostyle_bot?start=ref_REF000123
```

### 3. –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –±–æ—Ç–µ

#### –ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ /start:
```javascript
bot.onText(/\/start/, async (msg) => {
    const chatId = msg.chat.id;
    const startParam = msg.text.split(' ')[1]; // ref_REF000123
    
    if (startParam && startParam.startsWith('ref_')) {
        const referralCode = startParam.replace('ref_', '');
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
        await handleReferralRegistration(msg, referralCode);
    } else {
        // –û–±—ã—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        await handleNormalRegistration(msg);
    }
});
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
```javascript
async function handleReferralRegistration(msg, referralCode) {
    const chatId = msg.chat.id;
    const telegramId = msg.from.id.toString();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
    const existingClient = await getClientByTelegramId(telegramId);
    if (existingClient) {
        return bot.sendMessage(chatId, '–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ!');
    }
    
    // –ù–∞—Ö–æ–¥–∏–º —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ –ø–æ –∫–æ–¥—É
    const referrer = await pool.query(
        'SELECT id FROM clients WHERE referral_code = $1',
        [referralCode]
    );
    
    if (referrer.rows.length === 0) {
        return bot.sendMessage(chatId, '–ù–µ–≤–µ—Ä–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞!');
    }
    
    const referrerId = referrer.rows[0].id;
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
    const newClient = await registerClient(msg, referrerId);
    
    // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    await pool.query(
        `INSERT INTO referral_transactions (referrer_id, referee_id, status) 
         VALUES ($1, $2, 'approved')`,
        [referrerId, newClient.id]
    );
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –±–æ–Ω—É—Å–∞—Ö
    await bot.sendMessage(chatId, 
        'üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 500‚ÇΩ –±–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ!'
    );
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
    const referrerClient = await getClientById(referrerId);
    if (referrerClient.telegram_id) {
        await bot.sendMessage(referrerClient.telegram_id,
            'üéâ –í–∞—à –¥—Ä—É–≥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 500‚ÇΩ –±–æ–Ω—É—Å!'
        );
    }
}
```

### 4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –±–æ—Ç–µ

#### –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –±–æ—Ç–æ–º":
```javascript
// –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
async function handleShareBotCommand(msg) {
    const chatId = msg.chat.id;
    const client = await getClientByTelegramId(msg.from.id.toString());
    
    if (!client) {
        return bot.sendMessage(chatId, '‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.');
    }
    
    const referralLink = `https://t.me/gornostyle_bot?start=ref_${client.referral_code}`;
    
    return bot.sendMessage(chatId,
        'üì§ *–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –±–æ—Ç–æ–º —Å –¥—Ä—É–∑—å—è–º–∏!*\n\n' +
        'üîó *–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:*\n' +
        `${referralLink}\n\n` +
        'üí∞ *–í—ã –ø–æ–ª—É—á–∏—Ç–µ 500‚ÇΩ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ!*\n' +
        'üéÅ *–í–∞—à –¥—Ä—É–≥ —Ç–æ–∂–µ –ø–æ–ª—É—á–∏—Ç 500‚ÇΩ –±–æ–Ω—É—Å!*\n\n' +
        'üìä *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*\n' +
        `–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: ${client.referral_count || 0}\n` +
        `–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${client.referral_earnings || 0}‚ÇΩ`,
        {
            parse_mode: 'Markdown',
            reply_markup: {
                keyboard: [
                    ['üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é']
                ],
                resize_keyboard: true
            }
        }
    );
}
```

### 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

#### –î–æ–±–∞–≤–ª—è–µ–º –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:
```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ showUserProfile –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
const referralStats = await pool.query(
    `SELECT 
        COUNT(*) as total_referrals,
        SUM(referrer_bonus) as total_earnings
     FROM referral_transactions 
     WHERE referrer_id = $1 AND status = 'approved'`,
    [client.id]
);

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const statsMessage = 
    'üìä *–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞:*\n\n' +
    `üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: ${referralStats.rows[0].total_referrals || 0}\n` +
    `üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${referralStats.rows[0].total_earnings || 0}‚ÇΩ\n\n` +
    `üîó –í–∞—à–∞ —Å—Å—ã–ª–∫–∞: https://t.me/gornostyle_bot?start=ref_${client.referral_code}`;
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–ª—è –±–∏–∑–Ω–µ—Å–∞:
1. **–†–æ—Å—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã** - –∫–ª–∏–µ–Ω—Ç—ã —Å–∞–º–∏ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
2. **–ù–∏–∑–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è** - 500‚ÇΩ –≤–º–µ—Å—Ç–æ —Ä–µ–∫–ª–∞–º—ã
3. **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤** - –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
4. **–í–∏—Ä—É—Å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç** - –∫–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥—Ä—É–∑–µ–π

### –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:
1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
2. **–í—ã–≥–æ–¥–∞** - –ø–æ–ª—É—á–∞—é—Ç –¥–µ–Ω—å–≥–∏ –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π
3. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –≤—Å–µ –±–æ–Ω—É—Å—ã –≤–∏–¥–Ω—ã –≤ –∫–æ—à–µ–ª—å–∫–µ
4. **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ—Å—Ç—å** - –±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É

## –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ –º–µ—Ä—ã

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π:
1. **–û–¥–∏–Ω —Ä–µ—Ñ–µ—Ä–∞–ª –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç** - –Ω–µ–ª—å–∑—è –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏** - –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç = –æ–¥–∏–Ω —Ä–µ—Ñ–µ—Ä–∞–ª
3. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** - –±–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
ALTER TABLE referral_transactions 
ADD CONSTRAINT unique_referral_per_client 
UNIQUE (referee_id);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç —Å–∞–º —Å–µ–±—è
ALTER TABLE referral_transactions 
ADD CONSTRAINT no_self_referral 
CHECK (referrer_id != referee_id);
```

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### KPI —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã:
1. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫** - % –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
2. **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞**
3. **ROI —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã** - –¥–æ—Ö–æ–¥—ã vs –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –±–æ–Ω—É—Å—ã
4. **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∞** - –∫–∞–∫ –¥–æ–ª–≥–æ –∫–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º

### –û—Ç—á–µ—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–∞:
```sql
-- –¢–æ–ø —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤
SELECT 
    c.full_name,
    COUNT(rt.id) as referrals_count,
    SUM(rt.referrer_bonus) as total_earnings
FROM referral_transactions rt
JOIN clients c ON rt.referrer_id = c.id
WHERE rt.status = 'approved'
GROUP BY c.id, c.full_name
ORDER BY referrals_count DESC;
```

