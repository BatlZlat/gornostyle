# Ski-instruktor: Полная документация

---

## Описание проекта

Telegram-бот и веб-сайт для управления горнолыжной школой, записью на тренировки, администрированием, загрузкой и оптимизацией медиа-контента.

---

## Основные функции
- Регистрация и управление профилем
- Запись на тренировки
- Управление детьми
- Баланс и история операций
- Сертификаты
- Просмотр расписания
- Админ-панель
- Работа с медиа (фото, видео, логотипы)

---

## Технологии
- Node.js, Express.js
- PostgreSQL
- node-telegram-bot-api
- EJS (шаблоны)
- ffmpeg, sharp (обработка медиа)

---

## Структура проекта
```
src/                # Сервер, бот, бизнес-логика
public/             # Статические файлы (css, js, images)
docs/               # Документация
scripts/            # Скрипты для обслуживания и оптимизации
```

---

## Установка и запуск
1. Клонируйте репозиторий:
   ```bash
   git clone ...
   cd ski-instruktor
   ```
2. Установите зависимости:
   ```bash
   npm install
   ```
3. Создайте файл `.env` в корне (см. пример в старом README)
4. Запустите миграции:
   ```bash
   npm run migrate
   ```
5. Запустите проект:
   ```bash
   npm run start
   ```

---

## Работа с ботом
- `/start` — начало работы
- `/help` — справка
- Управление профилем, детьми, запись на тренировки, просмотр баланса и истории
- Для админов: управление расписанием, клиентами, тренерами, просмотр статистики

---

## Работа с медиа

### Фото и логотипы партнёров
- Папка: `public/images/partners/`
- Оптимальное разрешение: 320x245px (или пропорционально)
- Формат: JPG, PNG, WebP
- Имя файла: латиница и цифры (например, `maximum72.jpg`)
- Для добавления нового партнёра:
  1. Поместите изображение в папку
  2. Добавьте карточку в шаблон `views/index.ejs`:
     ```html
     <a href="http://сайт-партнёра.ru" class="partner-card" target="_blank">
         <div class="partner-image">
             <img src="images/partners/имя-файла.jpg" alt="Название партнёра">
         </div>
         <div class="partner-name">Название партнёра</div>
     </a>
     ```

### Скрипт для конвертации и сжатия видео
- Файл: `scripts/convert-video.js`
- Для автоматической конвертации видео (mp4, mov и др.) в WebM с оптимизацией размера и генерацией превью-изображения.
- Установка зависимостей:
  ```bash
  npm install fluent-ffmpeg @ffmpeg-installer/ffmpeg @ffprobe-installer/ffprobe sharp
  ```
- Настройте переменные в начале скрипта:
  ```js
  const inputPath = '../public/images/Ski_school.mov';
  const outputDir = '../public/images/videos';
  const targetSizeMB = 7;
  ```
- Запуск:
  - Из папки scripts:
    ```bash
    cd scripts
    node convert-video.js
    ```
  - Из корня:
    ```bash
    node scripts/convert-video.js 
    ```
- Результат: оптимизированное видео и превью появятся в папке `outputDir`.

---

## Резервное копирование и восстановление БД
- Скрипты для бэкапа и восстановления находятся в `scripts/`
- Автоматический бэкап по cron (см. старый README)

---

## Вклад в проект
- Форкните репозиторий
- Создайте ветку для новой функции
- Внесите изменения
- Создайте pull request

---

## Лицензия
MIT License

---

## Контакты и обратная связь
Если возникли вопросы или нужна доработка — пишите! 