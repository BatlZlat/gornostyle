# üè¶ –ê–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –¢–∏–Ω—å–∫–æ—Ñ—Ñ –Ω–∞ –¢–æ—á–∫–∞ –ë–∞–Ω–∫

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 8 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** üìã –í –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –í—ã—Å–æ–∫–∏–π

---

## üìä –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π](#1-—Ç–µ–∫—É—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø–ª–∞—Ç–µ–∂–µ–π)
2. [–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞](#2-—á—Ç–æ-–Ω—É–∂–Ω–æ-–∑–∞–ø—Ä–æ—Å–∏—Ç—å-—É-—Ç–æ—á–∫–∞-–±–∞–Ω–∫–∞)
3. [–í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —ç–∫–æ–Ω–æ–º–∏—è](#3-–≤–∞—Ä–∏–∞–Ω—Ç—ã-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏-–∏-—ç–∫–æ–Ω–æ–º–∏—è)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã](#4-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–Ω–æ–≤–æ–π-—Å–∏—Å—Ç–µ–º—ã)
5. [–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º](#5-–ø–ª–∞–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏-–ø–æ-—ç—Ç–∞–ø–∞–º)
6. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è](#6-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–∏–∑–º–µ–Ω–µ–Ω–∏—è)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#7-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. [–†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è](#8-—Ä–∏—Å–∫–∏-–∏-–º–∏—Ç–∏–≥–∞—Ü–∏—è)

---

## 1. –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### 1.1 –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¢–∏–Ω—å–∫–æ—Ñ—Ñ

**–§–∞–π–ª—ã —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã:**

```
src/services/kuligaPaymentService.js  - –°–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
src/routes/kuliga-payment.js          - –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç –¢–∏–Ω—å–∫–æ—Ñ—Ñ
src/routes/kuliga-booking.js          - –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏ –ø–ª–∞—Ç–µ–∂–µ–π
public/js/kuliga-booking.js           - –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ñ–æ—Ä–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```

**–¢–µ–∫—É—â–∏–π —Ñ–ª–æ—É –ø–ª–∞—Ç–µ–∂–∞:**

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   ‚Üì
2. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/kuliga/bookings
   ‚Üì
3. Backend —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î:
   - kuliga_bookings (—Å—Ç–∞—Ç—É—Å: pending)
   - kuliga_transactions (—Å—Ç–∞—Ç—É—Å: pending)
   ‚Üì
4. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è kuligaPaymentService.initPayment()
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ Tinkoff API
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –ø–æ–¥–ø–∏—Å–∏ (SHA-256)
   - –ü–æ–ª—É—á–∞–µ—Ç—Å—è paymentURL
   ‚Üì
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è { success: true, paymentUrl }
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –¢–∏–Ω—å–∫–æ—Ñ—Ñ
   ‚Üì
7. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –¢–∏–Ω—å–∫–æ—Ñ—Ñ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ /api/kuliga/payment/callback
   ‚Üì
8. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å:
   - CONFIRMED ‚Üí booking.status = 'confirmed'
   - REJECTED/CANCELED ‚Üí booking.status = 'cancelled'
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```env
TINKOFF_TERMINAL_KEY=stub
TINKOFF_PASSWORD=stub
TINKOFF_API_URL=https://securepay.tinkoff.ru/v2
KULIGA_PAYMENT_SUCCESS_URL=.../booking/success
KULIGA_PAYMENT_FAIL_URL=.../booking/fail
KULIGA_PAYMENT_CALLBACK_URL=.../api/kuliga/payment/callback
```

**–¢–∏–ø—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å –æ–ø–ª–∞—Ç–æ–π:**

1. **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** (`createIndividualBooking`)
   - –í—ã–±–æ—Ä —Ç—Ä–µ–Ω–µ—Ä–∞, –¥–∞—Ç—ã, —Å–ª–æ—Ç–∞
   - –£–∫–∞–∑–∞–Ω–∏–µ –º–µ—Å—Ç–∞ (–ö—É–ª–∏–≥–∞/–í–æ—Ä–æ–Ω–∏–Ω—Å–∫–∏–µ –≥–æ—Ä–∫–∏)
   - –¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞—Ä–∏—Ñ–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

2. **–ì—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** (`createGroupBooking`)
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –≥—Ä—É–ø–ø–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
   - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ —á–µ–ª–æ–≤–µ–∫–∞

3. **–ü—Ä–æ–≥—Ä–∞–º–º—ã** (`createProgramBooking`)
   - –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã –∏ –∫—É—Ä—Å—ã
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

### 1.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞ `kuliga_transactions`:**
```sql
- id
- booking_id
- client_id
- amount
- status (pending, completed, failed, cancelled)
- tinkoff_payment_id
- tinkoff_order_id
- tinkoff_status
- description
- created_at
```

**–¢–µ–∫—É—â–∏–µ –ø–æ–ª—è –¥–ª—è –¢–∏–Ω—å–∫–æ—Ñ—Ñ:**
- `tinkoff_payment_id` - ID –ø–ª–∞—Ç–µ–∂–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –¢–∏–Ω—å–∫–æ—Ñ—Ñ
- `tinkoff_order_id` - –ù–∞—à OrderId (kuliga-{bookingId})
- `tinkoff_status` - –°—Ç–∞—Ç—É—Å –∏–∑ webhook (CONFIRMED, REJECTED, etc.)

---

## 2. –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞

### 2.1 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ –Ω–∞–π–¥–∏—Ç–µ/–∑–∞–ø—Ä–æ—Å–∏—Ç–µ:**

#### ‚úÖ API Credentials

1. **Merchant ID (–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–µ—Ä—á–∞–Ω—Ç–∞)**
   - –ì–¥–µ –Ω–∞–π—Ç–∏: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Üí –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `TOCHKA_MERCHANT_ID`

2. **API Key / Token (JWT-–∫–ª—é—á)**
   - –ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º ‚Üí API ‚Üí –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `TOCHKA_API_KEY`
   - ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ä–∞–∑—É, –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∂—É—Ç!

3. **Customer Code (–ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞)**
   - –ì–¥–µ –Ω–∞–π—Ç–∏: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Üí –ü—Ä–æ—Ñ–∏–ª—å ‚Üí –†–µ–∫–≤–∏–∑–∏—Ç—ã
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `TOCHKA_CUSTOMER_CODE`

4. **Webhook Secret Key (–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è webhook)**
   - –ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API ‚Üí Webhooks ‚Üí –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –±–∞–Ω–∫–∞
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `TOCHKA_WEBHOOK_SECRET`

#### ‚úÖ URL'—ã API

5. **API Base URL**
   - –û–±—ã—á–Ω–æ: `https://api.tochka.com` –∏–ª–∏ `https://business.tochka.com/api`
   - –£—Ç–æ—á–Ω–∏—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π URL —É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `TOCHKA_API_URL`

6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**
   - –ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
   - –û–±—ã—á–Ω–æ: https://api.tochka.com/docs –∏–ª–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

#### ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhooks

7. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ URL'—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   ```
   Success URL: https://gornostyle.ru/instruktor-po-gornym-lyzham-snoubordy-tyumen/booking/success
   Fail URL: https://gornostyle.ru/instruktor-po-gornym-lyzham-snoubordy-tyumen/booking/fail
   Webhook URL: https://gornostyle.ru/api/kuliga/payment/callback
   ```

### 2.2 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

8. **–¢–µ—Å—Ç–æ–≤—ã–µ credentials**
   - –¢–µ—Å—Ç–æ–≤—ã–π Merchant ID
   - –¢–µ—Å—Ç–æ–≤—ã–π API Key
   - URL —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

9. **–°–ë–ü (–°–∏—Å—Ç–µ–º–∞ –ë—ã—Å—Ç—Ä—ã—Ö –ü–ª–∞—Ç–µ–∂–µ–π)**
   - –£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ –°–ë–ü
   - –¢–∞—Ä–∏—Ñ—ã –Ω–∞ –°–ë–ü
   - –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –°–ë–ü –≤ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ–æ—Ä–º—É

10. **–û–±–ª–∞—á–Ω–∞—è –∫–∞—Å—Å–∞**
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å —ç–∫–≤–∞–π—Ä–∏–Ω–≥–æ–º?
    - –ù—É–∂–Ω–∞ –ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞?
    - –ö–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á–µ–∫–∞?

### 2.3 –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:**

```
1. –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API? (JSON/XML/Form-encoded)
2. –ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤? (HMAC-SHA256, RSA, –¥—Ä—É–≥–æ–µ)
3. –ö–∞–∫–∏–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:
   - –°–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
   - –í–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤
4. –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è webhook'–∏? –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö?
5. –ï—Å—Ç—å –ª–∏ –≥–æ—Ç–æ–≤—ã–µ SDK –¥–ª—è Node.js?
6. –ö–∞–∫–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏?
7. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ 3-D Secure?
8. –ö–∞–∫ —Ñ–∏—Å–∫–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ–∫–∏ —á–µ—Ä–µ–∑ –æ–±–ª–∞—á–Ω—É—é –∫–∞—Å—Å—É?
```

**–ë–∏–∑–Ω–µ—Å-–≤–æ–ø—Ä–æ—Å—ã:**

```
1. –¢–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã –Ω–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥ (%)
2. –¢–∞—Ä–∏—Ñ—ã –Ω–∞ –°–ë–ü (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
3. –°—Ä–æ–∫ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ —Å—á–µ—Ç
4. –ï—Å—Ç—å –ª–∏ –∞–±–æ–Ω–µ–Ω—Ç—Å–∫–∞—è –ø–ª–∞—Ç–∞?
5. –ö–æ–º–∏—Å—Å–∏—è –∑–∞ –≤–æ–∑–≤—Ä–∞—Ç—ã
6. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
7. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```

---

## 3. –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —ç–∫–æ–Ω–æ–º–∏—è

### 3.1 –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π

| –í–∞—Ä–∏–∞–Ω—Ç | –ö–æ–º–∏—Å—Å–∏—è | –í—Ä–µ–º—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|---------|----------|------------------|-------|--------|
| **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥ (–∫–∞—Ä—Ç—ã)** | 1.4-2.5% | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | –ü—Ä–∏–≤—ã—á–Ω–æ –∫–ª–∏–µ–Ω—Ç–∞–º, –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –∫–∞—Ä—Ç—ã | –í—ã—à–µ –∫–æ–º–∏—Å—Å–∏—è |
| **–°–ë–ü (–°–∏—Å—Ç–µ–º–∞ –ë—ã—Å—Ç—Ä—ã—Ö –ü–ª–∞—Ç–µ–∂–µ–π)** | 0.4-0.7% | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è!** | –ù—É–∂–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞ |
| **–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏** | 1.4-2.5% | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª |
| **QR-–∫–æ–¥—ã (–°–ë–ü)** | 0.4-0.7% | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | –ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è, –±—ã—Å—Ç—Ä–æ | –ù—É–∂–Ω–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR |

### 3.2 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚≠ê

**–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã (payment checkout)       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                             ‚îÇ
‚îÇ  [üí≥ –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π]    [‚ö° –°–ë–ü (–≤—ã–≥–æ–¥–Ω–µ–µ)] ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ö–æ–º–∏—Å—Å–∏—è: ~2%         –ö–æ–º–∏—Å—Å–∏—è: ~0.5%     ‚îÇ
‚îÇ                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**

1. ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è –¥–æ 75%** –Ω–∞ –∫–æ–º–∏—Å—Å–∏—è—Ö (–µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≤—ã–±–µ—Ä–µ—Ç –°–ë–ü)
2. ‚úÖ **–í—ã–±–æ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞** - —É–¥–æ–±—Å—Ç–≤–æ vs —ç–∫–æ–Ω–æ–º–∏—è
3. ‚úÖ **–û—Ö–≤–∞—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏** - –∫–∞—Ä—Ç—ã –¥–ª—è —Ç–µ—Ö, —É –∫–æ–≥–æ –Ω–µ—Ç –°–ë–ü
4. ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - –æ–±–∞ –º–µ—Ç–æ–¥–∞ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω API

**–ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç —ç–∫–æ–Ω–æ–º–∏–∏:**

```
–ú–µ—Å—è—á–Ω—ã–π –æ–±–æ—Ä–æ—Ç: 300 000 ‚ÇΩ

–¢–æ–ª—å–∫–æ –∫–∞—Ä—Ç—ã (2%):     6 000 ‚ÇΩ –∫–æ–º–∏—Å—Å–∏–∏
–¢–æ–ª—å–∫–æ –°–ë–ü (0.5%):     1 500 ‚ÇΩ –∫–æ–º–∏—Å—Å–∏–∏

–ì–∏–±—Ä–∏–¥ (60% –°–ë–ü, 40% –∫–∞—Ä—Ç—ã):
  180 000 ‚ÇΩ √ó 0.5% = 900 ‚ÇΩ
  120 000 ‚ÇΩ √ó 2%   = 2 400 ‚ÇΩ
  –ò—Ç–æ–≥–æ:             3 300 ‚ÇΩ

–≠–∫–æ–Ω–æ–º–∏—è: 2 700 ‚ÇΩ/–º–µ—Å = 32 400 ‚ÇΩ/–≥–æ–¥ üí∞
```

### 3.3 –ß—Ç–æ —Ç–∞–∫–æ–µ –°–ë–ü –∏ –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**–°–ë–ü (–°–∏—Å—Ç–µ–º–∞ –ë—ã—Å—Ç—Ä—ã—Ö –ü–ª–∞—Ç–µ–∂–µ–π)** - —ç—Ç–æ —Ä–æ—Å—Å–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –º–µ–∂–¥—É –ª—é–±—ã–º–∏ –±–∞–Ω–∫–∞–º–∏ —á–µ—Ä–µ–∑ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:**

```
1. –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –°–ë–ü"
   ‚Üì
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è QR-–∫–æ–¥ –∏–ª–∏ —Å—Å—ã–ª–∫–∞
   ‚Üì
3. –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤–æ–µ–≥–æ –±–∞–Ω–∫–∞
   ‚Üì
4. –°–∫–∞–Ω–∏—Ä—É–µ—Ç QR –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
   ‚Üì
5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ —Å–≤–æ–µ–º –±–∞–Ω–∫–µ
   ‚Üì
6. –°—Ä–µ–¥—Å—Ç–≤–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –≤–∞—à —Å—á–µ—Ç
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –°–ë–ü:**

- üöÄ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ** - –¥–µ–Ω—å–≥–∏ —Å—Ä–∞–∑—É –Ω–∞ —Å—á–µ—Ç–µ
- üí∞ **–ù–∏–∑–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è** - –≤ 3-4 —Ä–∞–∑–∞ –Ω–∏–∂–µ, —á–µ–º –∫–∞—Ä—Ç—ã
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∏–¥–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
- üì± **–£–¥–æ–±—Å—Ç–≤–æ** - –Ω–µ –Ω—É–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
- üá∑üá∫ **–†–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞** - –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –°–ë–ü:**

- ‚ùå –ù—É–∂–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞ (–Ω–æ —É 90% –µ—Å—Ç—å)
- ‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∂–∏–ª—ã–µ –ª—é–¥–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è

### 3.4 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ UI/UX

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

```html
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –î–∞—Ç–∞: 15 –¥–µ–∫–∞–±—Ä—è 2024                      ‚îÇ
‚îÇ –í—Ä–µ–º—è: 14:00 - 15:00                       ‚îÇ
‚îÇ –¢—Ä–µ–Ω–µ—Ä: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤                        ‚îÇ
‚îÇ –ú–µ—Å—Ç–æ: –í–æ—Ä–æ–Ω–∏–Ω—Å–∫–∏–µ –≥–æ—Ä–∫–∏                   ‚îÇ
‚îÇ –£—á–∞—Å—Ç–Ω–∏–∫–∏: 2 —á–µ–ª–æ–≤–µ–∫–∞                      ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ –ò–¢–û–ì–û: 3 500 ‚ÇΩ                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                            ‚îÇ
‚îÇ  üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:                ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ –ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞: ~2%                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [–û–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π]                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ ‚ö° –°–ë–ü (–ë—ã—Å—Ç—Ä—ã–µ –ø–ª–∞—Ç–µ–∂–∏)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ üéÅ –í—ã–≥–æ–¥–Ω–µ–µ! –ö–æ–º–∏—Å—Å–∏—è: ~0.5%         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –°–ë–ü] ‚≠ê –í–´–ì–û–î–ù–û      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ  [‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### 4.1 –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π Payment Provider

**–ò–¥–µ—è:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- ‚úÖ –ú–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –±—É–¥—É—â–∏–º –º–∏–≥—Ä–∞—Ü–∏—è–º

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**

```
src/services/payment/
‚îú‚îÄ‚îÄ paymentProvider.js          # –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (factory)
‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ tinkoffProvider.js      # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –¢–∏–Ω—å–∫–æ—Ñ—Ñ (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ tochkaProvider.js       # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ mockProvider.js         # –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ signatureHelper.js      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π
    ‚îî‚îÄ‚îÄ receiptBuilder.js       # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤ (54-–§–ó)
```

### 4.2 –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Provider

**–ú–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π provider:**

```javascript
class PaymentProvider {
  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
   * @returns {Promise<{paymentId, paymentURL, status}>}
   */
  async initPayment({
    orderId,
    amount,
    description,
    customerPhone,
    customerEmail,
    items,
    paymentMethod // 'card' | 'sbp'
  }) {}

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
   * @returns {Promise<{status, paymentId}>}
   */
  async checkPaymentStatus(paymentId) {}

  /**
   * –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
   * @returns {Promise<{success, refundId}>}
   */
  async refundPayment(paymentId, amount) {}

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook –ø–æ–¥–ø–∏—Å–∏
   * @returns {boolean}
   */
  verifyWebhookSignature(payload, signature) {}

  /**
   * –ü–∞—Ä—Å–∏–Ω–≥ webhook –¥–∞–Ω–Ω—ã—Ö
   * @returns {ParsedWebhookData}
   */
  parseWebhookData(payload) {}
}
```

### 4.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã `kuliga_transactions`:**

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏
ALTER TABLE kuliga_transactions
  ADD COLUMN payment_provider VARCHAR(50) DEFAULT 'tinkoff',
  ADD COLUMN provider_payment_id VARCHAR(255),
  ADD COLUMN provider_order_id VARCHAR(255),
  ADD COLUMN provider_status VARCHAR(100),
  ADD COLUMN payment_method VARCHAR(50), -- 'card', 'sbp', 'qr'
  ADD COLUMN provider_raw_data JSONB; -- –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_transactions_provider_payment_id 
  ON kuliga_transactions(provider_payment_id);
CREATE INDEX idx_transactions_payment_provider 
  ON kuliga_transactions(payment_provider);

-- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
UPDATE kuliga_transactions SET
  payment_provider = 'tinkoff',
  provider_payment_id = tinkoff_payment_id,
  provider_order_id = tinkoff_order_id,
  provider_status = tinkoff_status,
  payment_method = 'card'
WHERE tinkoff_payment_id IS NOT NULL;
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã (Apple Pay, Google Pay)
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –≤ `provider_raw_data`
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 4.4 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ .env

```bash
# ====================================
# PAYMENT CONFIGURATION
# ====================================
PAYMENT_PROVIDER=tochka  # tinkoff | tochka | mock

# –¢–æ—á–∫–∞ –ë–∞–Ω–∫
TOCHKA_MERCHANT_ID=your_merchant_id
TOCHKA_CUSTOMER_CODE=your_customer_code
TOCHKA_API_KEY=your_api_key
TOCHKA_WEBHOOK_SECRET=your_webhook_secret
TOCHKA_API_URL=https://api.tochka.com/v1
TOCHKA_ENABLE_SBP=true  # –í–∫–ª—é—á–∏—Ç—å –°–ë–ü

# –¢–∏–Ω—å–∫–æ—Ñ—Ñ (legacy - –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)
TINKOFF_TERMINAL_KEY=stub
TINKOFF_PASSWORD=stub
TINKOFF_API_URL=https://securepay.tinkoff.ru/v2

# –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
PAYMENT_SUCCESS_URL=https://gornostyle.ru/instruktor-po-gornym-lyzham-snoubordy-tyumen/booking/success
PAYMENT_FAIL_URL=https://gornostyle.ru/instruktor-po-gornym-lyzham-snoubordy-tyumen/booking/fail
PAYMENT_CALLBACK_URL=https://gornostyle.ru/api/kuliga/payment/callback

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
PAYMENT_TEST_MODE=false  # true –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
```

---

## 5. –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

- [x] ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
- [ ] üìß –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
- [ ] üìÑ –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] üîë –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ credentials
- [ ] üìã –ò–∑—É—á–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
- [ ] üí∞ –£—Ç–æ—á–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã (—ç–∫–≤–∞–π—Ä–∏–Ω–≥ + –°–ë–ü)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

### –≠—Ç–∞–ø 2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

- [ ] üèóÔ∏è –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PaymentProvider`
- [ ] üîß –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞ –≤ `TinkoffProvider`
- [ ] üß™ –°–æ–∑–¥–∞—Ç—å `MockProvider` –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- [ ] üóÑÔ∏è –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
- [ ] ‚öôÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (.env)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –≥–æ—Ç–æ–≤–∞—è –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

### –≠—Ç–∞–ø 3: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¢–æ—á–∫–∞ –ë–∞–Ω–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (3-5 –¥–Ω–µ–π)

**–ó–∞–¥–∞—á–∏:**

- [ ] üí≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `TochkaProvider` (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
  - [ ] `initPayment()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–∫–∞—Ä—Ç—ã)
  - [ ] `checkPaymentStatus()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
  - [ ] `verifyWebhookSignature()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
  - [ ] `parseWebhookData()` - –ø–∞—Ä—Å–∏–Ω–≥ webhook
- [ ] ‚ö° –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –°–ë–ü
  - [ ] `initPayment({ paymentMethod: 'sbp' })`
  - [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è –°–ë–ü
- [ ] üß™ Unit-—Ç–µ—Å—Ç—ã –¥–ª—è `TochkaProvider`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—á–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞.

### –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI/UX (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

- [ ] üé® –î–∏–∑–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
- [ ] üíª Frontend: –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä "–ö–∞—Ä—Ç–∞" / "–°–ë–ü"
- [ ] üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
- [ ] ‚ú® –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ feedback –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] üìÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã success/fail

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

```javascript
// public/js/kuliga-booking.js
async function handleSubmit(event) {
  // ...
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
  const paymentMethod = await showPaymentMethodModal();
  // 'card' –∏–ª–∏ 'sbp'
  
  const payload = {
    ...buildPayload(),
    paymentMethod
  };
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
  const response = await fetch(API.createBooking, {
    method: 'POST',
    body: JSON.stringify(payload)
  });
  
  // ...
}

function showPaymentMethodModal() {
  return new Promise((resolve) => {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
  });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã.

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ booking flow (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

- [ ] üîß –û–±–Ω–æ–≤–∏—Ç—å `kuliga-booking.js` route
  - [ ] –ü—Ä–∏–Ω–∏–º–∞—Ç—å `paymentMethod` –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
  - [ ] –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ `paymentProvider.initPayment()`
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø –æ–ø–ª–∞—Ç—ã –≤ –ë–î
- [ ] üîî –û–±–Ω–æ–≤–∏—Ç—å webhook handler
  - [ ] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ payload
  - [ ] –í—ã–∑—ã–≤–∞—Ç—å –Ω—É–∂–Ω—ã–π provider –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] üìß –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - [ ] –£–∫–∞–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π payment flow –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.

### –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3-4 –¥–Ω—è)

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

1. **–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π (—É—Å–ø–µ—à–Ω–∞—è)**
   - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - [ ] –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¢–æ—á–∫–∞ –ë–∞–Ω–∫
   - [ ] –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
   - [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ webhook
   - [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
   - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

2. **–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π (–Ω–µ—É—Å–ø–µ—à–Ω–∞—è)**
   - [ ] –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
   - [ ] –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É fail
   - [ ] –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - [ ] –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–ª–æ—Ç–∞

3. **–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –°–ë–ü (—É—Å–ø–µ—à–Ω–∞—è)**
   - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
   - [ ] –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–∞–Ω–∫–∞
   - [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ webhook
   - [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

4. **Edge cases**
   - [ ] –î–≤–æ–π–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
   - [ ] –¢–∞–π–º–∞—É—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
   - [ ] Webhook –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ä–∞–Ω—å—à–µ, —á–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω—É–ª—Å—è
   - [ ] –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å—å webhook

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –≥–æ—Ç–æ–≤–∞—è –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.

### –≠—Ç–∞–ø 7: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout (1-2 –Ω–µ–¥–µ–ª–∏)

**–ü–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**

1. **Week 1: Soft launch (10% —Ç—Ä–∞—Ñ–∏–∫–∞)**
   - [ ] –í–∫–ª—é—á–∏—Ç—å –¢–æ—á–∫–∞ –ë–∞–Ω–∫ –¥–ª—è 10% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
   - [ ] –°–±–æ—Ä —Ñ–∏–¥–±–µ–∫–∞
   - [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤

2. **Week 2: Scale up (50% —Ç—Ä–∞—Ñ–∏–∫–∞)**
   - [ ] –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 50% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - [ ] –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
   - [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º

3. **Week 3: Full rollout (100%)**
   - [ ] –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å–µ—Ö –Ω–∞ –¢–æ—á–∫–∞ –ë–∞–Ω–∫
   - [ ] –û—Å—Ç–∞–≤–∏—Ç—å –¢–∏–Ω—å–∫–æ—Ñ—Ñ –∫–∞–∫ fallback
   - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–ú–µ—Ç–æ–¥–∏–∫–∞ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```javascript
// –í –∫–æ–Ω—Ñ–∏–≥–µ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
const shouldUseTochka = () => {
  const rolloutPercent = process.env.TOCHKA_ROLLOUT_PERCENT || 0;
  return Math.random() * 100 < rolloutPercent;
};

const provider = shouldUseTochka() ? 'tochka' : 'tinkoff';
```

### –≠—Ç–∞–ø 8: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã (2-3 –Ω–µ–¥–µ–ª–∏)

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:**

1. ‚úÖ **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** (–≠—Ç–∞–ø 5)
2. **–ì—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** (Week 1)
3. **–ü—Ä–æ–≥—Ä–∞–º–º—ã –∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã** (Week 2)
4. **–î—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏** (–µ—Å–ª–∏ –µ—Å—Ç—å) (Week 3)

---

## 6. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 6.1 –ù–æ–≤—ã–π —Ñ–∞–π–ª: `src/services/payment/paymentProvider.js`

```javascript
/**
 * Factory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ payment provider
 */
const TinkoffProvider = require('./providers/tinkoffProvider');
const TochkaProvider = require('./providers/tochkaProvider');
const MockProvider = require('./providers/mockProvider');

class PaymentProviderFactory {
  static create(providerName = null) {
    const provider = providerName || process.env.PAYMENT_PROVIDER || 'tinkoff';
    
    switch (provider.toLowerCase()) {
      case 'tochka':
        return new TochkaProvider();
      
      case 'tinkoff':
        return new TinkoffProvider();
      
      case 'mock':
        return new MockProvider();
      
      default:
        throw new Error(`Unsupported payment provider: ${provider}`);
    }
  }
  
  /**
   * –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ webhook payload
   */
  static detectProviderFromWebhook(payload) {
    if (payload.TerminalKey || payload.OrderId?.startsWith('kuliga-')) {
      return 'tinkoff';
    }
    
    if (payload.merchantId || payload.paymentId) {
      return 'tochka';
    }
    
    throw new Error('Unable to detect payment provider from webhook');
  }
}

module.exports = PaymentProviderFactory;
```

### 6.2 –ù–æ–≤—ã–π —Ñ–∞–π–ª: `src/services/payment/providers/tochkaProvider.js`

```javascript
const axios = require('axios');
const crypto = require('crypto');

class TochkaProvider {
  constructor() {
    this.merchantId = process.env.TOCHKA_MERCHANT_ID;
    this.apiKey = process.env.TOCHKA_API_KEY;
    this.apiUrl = process.env.TOCHKA_API_URL;
    this.webhookSecret = process.env.TOCHKA_WEBHOOK_SECRET;
    this.enableSBP = process.env.TOCHKA_ENABLE_SBP === 'true';
    
    if (!this.merchantId || !this.apiKey) {
      console.warn('‚ö†Ô∏è  Tochka Bank: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç credentials');
    }
  }
  
  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
   */
  async initPayment({
    orderId,
    amount,
    description,
    customerPhone,
    customerEmail,
    items,
    paymentMethod = 'card' // 'card' | 'sbp'
  }) {
    if (!this.merchantId || !this.apiKey) {
      throw new Error('–¢–æ—á–∫–∞ –ë–∞–Ω–∫ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç credentials)');
    }
    
    const amountKopecks = Math.round(amount * 100);
    
    const requestBody = {
      merchantId: this.merchantId,
      orderId: orderId,
      amount: amountKopecks,
      currency: 'RUB',
      description: description,
      returnUrl: process.env.PAYMENT_SUCCESS_URL,
      failUrl: process.env.PAYMENT_FAIL_URL,
      notificationUrl: process.env.PAYMENT_CALLBACK_URL,
      
      // –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
      customer: {
        email: customerEmail,
        phone: customerPhone
      },
      
      // –ß–µ–∫ –¥–ª—è 54-–§–ó
      receipt: {
        taxation: 'usn_income', // –î–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö
        items: items.map(item => ({
          name: item.Name,
          price: item.Price,
          quantity: item.Quantity,
          amount: item.Amount,
          tax: 'none',
          paymentMethod: 'full_payment',
          paymentObject: 'service'
        }))
      }
    };
    
    // –î–ª—è –°–ë–ü –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥
    if (paymentMethod === 'sbp' && this.enableSBP) {
      requestBody.paymentMethod = 'SBP';
    }
    
    try {
      const response = await axios.post(
        `${this.apiUrl}/payments/init`,
        requestBody,
        {
          headers: {
            'Authorization': `Bearer ${this.apiKey}`,
            'Content-Type': 'application/json'
          },
          timeout: 15000
        }
      );
      
      const data = response.data;
      
      if (!data.success && !data.paymentUrl) {
        throw new Error(data.message || '–¢–æ—á–∫–∞ –ë–∞–Ω–∫ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');
      }
      
      return {
        paymentId: data.paymentId,
        paymentURL: data.paymentUrl,
        status: data.status,
        qrCodeUrl: data.qrCodeUrl, // –î–ª—è –°–ë–ü
        paymentMethod: paymentMethod
      };
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –¢–æ—á–∫–∞ –ë–∞–Ω–∫ API:', error.response?.data || error.message);
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –≤ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–µ');
    }
  }
  
  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
   */
  async checkPaymentStatus(paymentId) {
    const response = await axios.get(
      `${this.apiUrl}/payments/${paymentId}`,
      {
        headers: {
          'Authorization': `Bearer ${this.apiKey}`
        }
      }
    );
    
    return {
      status: response.data.status,
      paymentId: response.data.paymentId,
      amount: response.data.amount
    };
  }
  
  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook
   */
  verifyWebhookSignature(payload, signature) {
    if (!this.webhookSecret) {
      console.warn('‚ö†Ô∏è  Webhook secret –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É');
      return true;
    }
    
    // –§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
    // –û–±—ã—á–Ω–æ —ç—Ç–æ HMAC-SHA256 –æ—Ç JSON payload
    const expectedSignature = crypto
      .createHmac('sha256', this.webhookSecret)
      .update(JSON.stringify(payload))
      .digest('hex');
    
    return signature === expectedSignature;
  }
  
  /**
   * –ü–∞—Ä—Å–∏–Ω–≥ webhook –¥–∞–Ω–Ω—ã—Ö
   */
  parseWebhookData(payload) {
    return {
      orderId: payload.orderId,
      paymentId: payload.paymentId,
      status: payload.status, // SUCCESS, FAILED, PENDING, etc.
      amount: payload.amount,
      paymentMethod: payload.paymentMethod
    };
  }
  
  /**
   * –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
   */
  async refundPayment(paymentId, amount) {
    const amountKopecks = Math.round(amount * 100);
    
    const response = await axios.post(
      `${this.apiUrl}/payments/${paymentId}/refund`,
      {
        amount: amountKopecks
      },
      {
        headers: {
          'Authorization': `Bearer ${this.apiKey}`,
          'Content-Type': 'application/json'
        }
      }
    );
    
    return {
      success: response.data.success,
      refundId: response.data.refundId
    };
  }
}

module.exports = TochkaProvider;
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –≠—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è. –¢–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π, endpoints –∏ —Ñ–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∏ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞!

### 6.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `src/routes/kuliga-booking.js`

```javascript
// –ë—ã–ª–æ:
const { initPayment } = require('../services/kuligaPaymentService');

// –°—Ç–∞–ª–æ:
const PaymentProviderFactory = require('../services/payment/paymentProvider');

// –í createIndividualBooking():
const createIndividualBooking = async (req, res) => {
  const {
    // ... existing fields
    paymentMethod = 'card', // –ù–û–í–û–ï: 'card' –∏–ª–∏ 'sbp'
  } = req.body || {};
  
  // ... validation, create booking, transaction
  
  // –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
  const paymentProvider = PaymentProviderFactory.create();
  
  let payment;
  try {
    payment = await paymentProvider.initPayment({
      orderId: `kuliga-${bookingId}`,
      amount: totalPrice,
      description,
      customerPhone: normalizedPhone,
      customerEmail: email?.trim() || undefined,
      items: [...],
      paymentMethod // –ü–µ—Ä–µ–¥–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
    });
  } catch (paymentError) {
    // ... error handling
  }
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ –ë–î
  await pool.query(
    `UPDATE kuliga_transactions
     SET payment_provider = $1,
         provider_payment_id = $2,
         provider_order_id = $3,
         provider_status = $4,
         payment_method = $5,
         provider_raw_data = $6
     WHERE id = $7`,
    [
      process.env.PAYMENT_PROVIDER || 'tochka',
      payment.paymentId,
      `kuliga-${bookingId}`,
      payment.status,
      paymentMethod,
      JSON.stringify(payment),
      transactionId
    ]
  );
  
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º URL (–∏–ª–∏ QR –¥–ª—è –°–ë–ü)
  const response = {
    success: true,
    bookingId,
    paymentUrl: payment.paymentURL,
    paymentMethod
  };
  
  if (payment.qrCodeUrl) {
    response.qrCodeUrl = payment.qrCodeUrl;
  }
  
  return res.json(response);
};
```

### 6.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `src/routes/kuliga-payment.js` (webhook handler)

```javascript
const express = require('express');
const { pool } = require('../db');
const PaymentProviderFactory = require('../services/payment/paymentProvider');

const router = express.Router();

router.post('/callback', express.json(), async (req, res) => {
  const payload = req.body || {};
  
  try {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ payload
    const providerName = PaymentProviderFactory.detectProviderFromWebhook(payload);
    const provider = PaymentProviderFactory.create(providerName);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
    const signature = req.headers['x-signature'] || req.headers['signature'] || payload.Token;
    if (!provider.verifyWebhookSignature(payload, signature)) {
      console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å—å webhook –æ—Ç', providerName);
      return res.status(400).send('Invalid signature');
    }
    
    // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ
    const webhookData = provider.parseWebhookData(payload);
    const { orderId, paymentId, status, amount, paymentMethod } = webhookData;
    
    if (!orderId || !orderId.startsWith('kuliga-')) {
      console.warn('‚ö†Ô∏è –ü–æ–ª—É—á–µ–Ω webhook —Å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º OrderId:', orderId);
      return res.status(200).send('OK');
    }
    
    const bookingId = Number(orderId.replace('kuliga-', ''));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î
    const client = await pool.connect();
    try {
      await client.query('BEGIN');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
      await client.query(
        `UPDATE kuliga_transactions
         SET provider_status = $1,
             provider_payment_id = $2,
             status = CASE
               WHEN $1 IN ('SUCCESS', 'CONFIRMED') THEN 'completed'
               WHEN $1 IN ('FAILED', 'REJECTED', 'CANCELED') THEN 'failed'
               ELSE status
             END,
             provider_raw_data = $3
         WHERE booking_id = $4`,
        [status, paymentId, JSON.stringify(payload), bookingId]
      );
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      if (['SUCCESS', 'CONFIRMED'].includes(status)) {
        await client.query(
          `UPDATE kuliga_bookings
           SET status = 'confirmed'
           WHERE id = $1`,
          [bookingId]
        );
      } else if (['FAILED', 'REJECTED', 'CANCELED'].includes(status)) {
        await client.query(
          `UPDATE kuliga_bookings
           SET status = 'cancelled',
               cancellation_reason = $1,
               cancelled_at = CURRENT_TIMESTAMP
           WHERE id = $2`,
          ['–û—Ç–º–µ–Ω–µ–Ω–æ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π', bookingId]
        );
      }
      
      await client.query('COMMIT');
      
      console.log(`‚úÖ Webhook –æ–±—Ä–∞–±–æ—Ç–∞–Ω: ${providerName} | ${orderId} | ${status}`);
    } catch (error) {
      await client.query('ROLLBACK');
      console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook:', error);
    } finally {
      client.release();
    }
    
    res.status(200).send('OK');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ webhook:', error);
    res.status(500).send('ERROR');
  }
});

module.exports = router;
```

### 6.5 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ frontend: `public/js/kuliga-booking.js`

```javascript
// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
function showPaymentMethodModal(totalAmount) {
  return new Promise((resolve) => {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = document.createElement('div');
    modal.className = 'payment-method-modal';
    modal.innerHTML = `
      <div class="payment-method-overlay"></div>
      <div class="payment-method-content">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
        
        <div class="payment-method-option" data-method="card">
          <div class="payment-method-icon">üí≥</div>
          <div class="payment-method-info">
            <h4>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</h4>
            <p>Visa, MasterCard, –ú–ò–†</p>
            <p class="payment-method-fee">–ö–æ–º–∏—Å—Å–∏—è –±–∞–Ω–∫–∞: ~2%</p>
          </div>
          <button class="payment-method-btn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        </div>
        
        <div class="payment-method-option payment-method-recommended" data-method="sbp">
          <div class="payment-method-badge">‚≠ê –í–´–ì–û–î–ù–û</div>
          <div class="payment-method-icon">‚ö°</div>
          <div class="payment-method-info">
            <h4>–°–ë–ü (–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)</h4>
            <p>–ß–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –±–∞–Ω–∫–∞</p>
            <p class="payment-method-fee">–ö–æ–º–∏—Å—Å–∏—è: ~0.5% (–≤ 4 —Ä–∞–∑–∞ –¥–µ—à–µ–≤–ª–µ!)</p>
          </div>
          <button class="payment-method-btn payment-method-btn-primary">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        </div>
        
        <button class="payment-method-cancel">–û—Ç–º–µ–Ω–∏—Ç—å</button>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    modal.querySelectorAll('.payment-method-option').forEach(option => {
      option.querySelector('button').addEventListener('click', () => {
        const method = option.dataset.method;
        document.body.removeChild(modal);
        resolve(method);
      });
    });
    
    modal.querySelector('.payment-method-cancel').addEventListener('click', () => {
      document.body.removeChild(modal);
      resolve(null);
    });
  });
}

// –û–±–Ω–æ–≤–ª—è–µ–º handleSubmit
async function handleSubmit(event) {
  event.preventDefault();
  clearMessage();
  
  if (!validateForm()) {
    return;
  }
  
  if (!consentCheckbox.checked) {
    setMessage('–ù—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.', 'error');
    return;
  }
  
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
  const totalAmount = calculateTotalAmount();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
  const paymentMethod = await showPaymentMethodModal(totalAmount);
  
  if (!paymentMethod) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
    return;
  }
  
  setMessage('–°–æ–∑–¥–∞—ë–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ–ø–ª–∞—Ç—É...', 'neutral');
  
  const payload = buildPayload();
  payload.paymentMethod = paymentMethod; // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
  
  try {
    const response = await fetch(API.createBooking, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
      },
      body: JSON.stringify(payload),
    });
    
    const data = await response.json();
    if (!response.ok || !data.success) {
      throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ');
    }
    
    setMessage('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã...', 'success');
    localStorage.removeItem(STORAGE_KEY);
    
    // –î–ª—è –°–ë–ü –º–æ–∂–µ—Ç –±—ã—Ç—å QR-–∫–æ–¥
    if (paymentMethod === 'sbp' && data.qrCodeUrl) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º QR-–∫–æ–¥
      showSBPQRCode(data.qrCodeUrl, data.paymentUrl);
    } else {
      // –û–±—ã—á–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      window.location.href = data.paymentUrl;
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
    setMessage(error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è QR-–∫–æ–¥–∞ –°–ë–ü
function showSBPQRCode(qrCodeUrl, paymentUrl) {
  const modal = document.createElement('div');
  modal.className = 'sbp-qr-modal';
  modal.innerHTML = `
    <div class="sbp-qr-overlay"></div>
    <div class="sbp-qr-content">
      <h3>–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –°–ë–ü</h3>
      <p>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤–∞—à–µ–≥–æ –±–∞–Ω–∫–∞:</p>
      <img src="${qrCodeUrl}" alt="QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã" />
      <p>–ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:</p>
      <a href="${paymentUrl}" class="sbp-payment-link">–û—Ç–∫—Ä—ã—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±–∞–Ω–∫–∞</a>
      <button class="sbp-close">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  modal.querySelector('.sbp-close').addEventListener('click', () => {
    document.body.removeChild(modal);
    // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
    window.location.href = '/instruktor-po-gornym-lyzham-snoubordy-tyumen/booking/pending';
  });
}
```

---

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 7.1 Unit-—Ç–µ—Å—Ç—ã

**–¢–µ—Å—Ç—ã –¥–ª—è TochkaProvider:**

```javascript
// tests/payment/tochkaProvider.test.js
const TochkaProvider = require('../../src/services/payment/providers/tochkaProvider');

describe('TochkaProvider', () => {
  let provider;
  
  beforeEach(() => {
    process.env.TOCHKA_MERCHANT_ID = 'test_merchant';
    process.env.TOCHKA_API_KEY = 'test_key';
    process.env.TOCHKA_API_URL = 'https://api.test.tochka.com';
    provider = new TochkaProvider();
  });
  
  test('initPayment should create payment for card', async () => {
    // Mock axios
    // ...test logic
  });
  
  test('initPayment should create payment for SBP', async () => {
    // ...test logic
  });
  
  test('verifyWebhookSignature should validate correct signature', () => {
    // ...test logic
  });
  
  test('verifyWebhookSignature should reject incorrect signature', () => {
    // ...test logic
  });
  
  test('parseWebhookData should extract correct fields', () => {
    const payload = {
      orderId: 'kuliga-123',
      paymentId: 'pay_123',
      status: 'SUCCESS',
      amount: 350000
    };
    
    const result = provider.parseWebhookData(payload);
    
    expect(result.orderId).toBe('kuliga-123');
    expect(result.status).toBe('SUCCESS');
  });
});
```

### 7.2 Integration-—Ç–µ—Å—Ç—ã

**–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É:**

```javascript
// tests/integration/booking-payment.test.js
const request = require('supertest');
const app = require('../../src/app');

describe('Booking with Tochka payment', () => {
  test('should create booking and redirect to payment', async () => {
    const response = await request(app)
      .post('/api/kuliga/bookings')
      .send({
        fullName: '–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤',
        birthDate: '1990-01-01',
        phone: '+79991234567',
        email: 'test@test.ru',
        priceId: 1,
        sportType: 'ski',
        date: '2024-12-20',
        slotId: 1,
        instructorId: 1,
        location: 'kuliga',
        participants: [{ name: '–¢–µ—Å—Ç', birthYear: 2010 }],
        paymentMethod: 'card',
        consentConfirmed: true
      });
    
    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
    expect(response.body.paymentUrl).toBeDefined();
  });
  
  test('should process webhook and confirm booking', async () => {
    // Create booking first
    // ...
    
    // Simulate webhook
    const webhookResponse = await request(app)
      .post('/api/kuliga/payment/callback')
      .set('X-Signature', 'valid_signature')
      .send({
        orderId: 'kuliga-1',
        paymentId: 'pay_123',
        status: 'SUCCESS',
        amount: 350000
      });
    
    expect(webhookResponse.status).toBe(200);
    
    // Check booking status in DB
    // ...
  });
});
```

### 7.3 E2E —Ç–µ—Å—Ç—ã

**–° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Playwright/Puppeteer:**

```javascript
// tests/e2e/booking-flow.test.js
const { chromium } = require('playwright');

describe('E2E: Booking with payment', () => {
  let browser, page;
  
  beforeAll(async () => {
    browser = await chromium.launch();
  });
  
  afterAll(async () => {
    await browser.close();
  });
  
  test('should complete booking with card payment', async () => {
    page = await browser.newPage();
    
    // 1. –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    await page.goto('https://gornostyle.ru/instruktor-po-gornym-lyzham-snoubordy-tyumen/booking');
    
    // 2. –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
    await page.fill('#kuligaClientName', '–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤');
    await page.fill('#kuligaClientBirthDate', '1990-01-01');
    await page.fill('#kuligaClientPhone', '+79991234567');
    await page.fill('#kuligaClientEmail', 'test@test.ru');
    
    // 3. –í—ã–±–∏—Ä–∞–µ–º —É—Å–ª—É–≥—É, –¥–∞—Ç—É, —Ç—Ä–µ–Ω–µ—Ä–∞
    // ...
    
    // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
    await page.click('button[type="submit"]');
    
    // 5. –í—ã–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã
    await page.click('[data-method="card"] button');
    
    // 6. –ñ–¥–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã
    await page.waitForURL(/tochka\.com|gornostyle\.ru\/booking\/success/);
    
    // 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º URL
    const url = page.url();
    expect(url).toContain('payment');
  });
});
```

---

## 8. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### 8.1 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| **API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–∂–∏–¥–∞–Ω–∏–π** | –í—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –¢—â–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, —Å–æ–∑–¥–∞—Ç—å MVP –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ |
| **Webhook –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞** | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å polling –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ webhooks |
| **–î–≤–æ–π–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (race condition)** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ orderId), —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î |
| **–ë–∞–≥–∏ –≤ legacy –∫–æ–¥–µ –¢–∏–Ω—å–∫–æ—Ñ—Ñ** | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏, –æ—Å—Ç–∞–≤–∏—Ç—å –¢–∏–Ω—å–∫–æ—Ñ—Ñ –∫–∞–∫ fallback |
| **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–ø–∏—Å—å—é webhook** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ |

### 8.2 –ë–∏–∑–Ω–µ—Å-—Ä–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| **–ü–∞–¥–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑-–∑–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã** | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ |
| **–ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç –°–ë–ü** | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –û–±—É—á–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏, –≤–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7 |
| **–í—ã—Å–æ–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –ó–∞—Ä–∞–Ω–µ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –°–ë–ü –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–π |
| **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π** | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | –¢—â–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–ª–∞—á–Ω—É—é –∫–∞—Å—Å—É, —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —á–µ–∫–∞–º–∏ |

### 8.3 –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| **–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞** | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | Fallback –Ω–∞ –¢–∏–Ω—å–∫–æ—Ñ—Ñ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ uptime, –∞–ª–µ—Ä—Ç—ã |
| **–î–ª–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞** | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å, —Ç–∞–π–º–∞—É—Ç—ã, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ |
| **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏** | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î, —Ç—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ |
| **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –ß–µ—Ç–∫–∏–π –ø–ª–∞–Ω, –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏ |

### 8.4 Plan B (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–ª–æ—Å—å**
- –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –Ω–∞ –¢–∏–Ω—å–∫–æ—Ñ—Ñ
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é —Å–∏—Å—Ç–µ–º—É
- –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–º–æ—â—å —É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–∞–¥–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—è –Ω–∞ 20%+**
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ò—Å–ø—Ä–∞–≤–ª—è–µ–º UX –ø—Ä–æ–±–ª–µ–º—ã
- –ü–æ–≤—Ç–æ—Ä—è–µ–º rollout

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**
- Feature flag –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
- –ë—ã—Å—Ç—Ä—ã–π rollback —á–µ—Ä–µ–∑ `PAYMENT_PROVIDER=tinkoff`
- Hotfix –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π deploy

---

## 9. –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –î–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- [ ] ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã (DONE)
- [ ] üìß –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
- [ ] üìÑ –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API
- [ ] üîë –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ credentials
- [ ] üí∞ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ—ã
- [ ] üìã –£—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

- [ ] üèóÔ∏è –°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é PaymentProvider
- [ ] üí≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TochkaProvider
- [ ] ‚ö° –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –°–ë–ü
- [ ] üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] üé® –û–±–Ω–æ–≤–∏—Ç—å UI/UX
- [ ] üß™ –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã (unit + integration)
- [ ] üìù –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] ‚úÖ –¢–µ—Å—Ç—ã –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] ‚úÖ E2E —Ç–µ—Å—Ç—ã
- [ ] ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging
- [ ] ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ webhooks
- [ ] ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ–∫–æ–≤
- [ ] ‚úÖ Load testing (–Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –ó–∞–ø—É—Å–∫

- [ ] üöÄ Deploy –Ω–∞ production
- [ ] üìä –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
- [ ] üîÑ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout (10% ‚Üí 50% ‚Üí 100%)
- [ ] üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- [ ] üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤
- [ ] üì¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

- [ ] üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–Ω–≤–µ—Ä—Å–∏—è, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫)
- [ ] üí¨ –°–±–æ—Ä —Ñ–∏–¥–±–µ–∫–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] üìÑ –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] üéâ –ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–∞!

---

## 10. –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

**–ü—Ä–∏ –æ–±–æ—Ä–æ—Ç–µ 300 000 ‚ÇΩ/–º–µ—Å:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–Ω—å–∫–æ—Ñ—Ñ (2%) | –¢–æ—á–∫–∞ (2%) | –¢–æ—á–∫–∞ + –°–ë–ü (50% –°–ë–ü) |
|---------|---------------|------------|------------------------|
| –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —ç–∫–≤–∞–π—Ä–∏–Ω–≥ | 6 000 ‚ÇΩ | 6 000 ‚ÇΩ | 3 300 ‚ÇΩ |
| –≠–∫–æ–Ω–æ–º–∏—è | - | 0 ‚ÇΩ | **2 700 ‚ÇΩ/–º–µ—Å** |
| –≠–∫–æ–Ω–æ–º–∏—è –∑–∞ –≥–æ–¥ | - | 0 ‚ÇΩ | **32 400 ‚ÇΩ/–≥–æ–¥** |

**–ü—Ä–∏ –æ–±–æ—Ä–æ—Ç–µ 500 000 ‚ÇΩ/–º–µ—Å:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–Ω—å–∫–æ—Ñ—Ñ (2%) | –¢–æ—á–∫–∞ (1.5%) | –¢–æ—á–∫–∞ + –°–ë–ü (60% –°–ë–ü) |
|---------|---------------|--------------|------------------------|
| –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —ç–∫–≤–∞–π—Ä–∏–Ω–≥ | 10 000 ‚ÇΩ | 7 500 ‚ÇΩ | 4 000 ‚ÇΩ |
| –≠–∫–æ–Ω–æ–º–∏—è | - | 2 500 ‚ÇΩ | **6 000 ‚ÇΩ/–º–µ—Å** |
| –≠–∫–æ–Ω–æ–º–∏—è –∑–∞ –≥–æ–¥ | - | 30 000 ‚ÇΩ | **72 000 ‚ÇΩ/–≥–æ–¥** |

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

‚úÖ **–ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã  
‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫** - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤  

### UX —É–ª—É—á—à–µ–Ω–∏—è

‚úÖ **–í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã** - —É–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞  
‚úÖ **–°–ë–ü** - –±—ã—Å—Ç—Ä–∞—è –æ–ø–ª–∞—Ç–∞ –±–µ–∑ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã  
‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –∫–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –∫–æ–º–∏—Å—Å–∏–∏  
‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã  

---

## 11. –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–¢–æ—á–∫–∞ –ë–∞–Ω–∫:** https://www.tochka.com/
- **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç:** https://www.tochka.com/login
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –∏–ª–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- **–°–ë–ü:** https://sbp.nspk.ru/
- **54-–§–ó (–æ–Ω–ª–∞–π–Ω-–∫–∞—Å—Å—ã):** https://www.nalog.gov.ru/

---

## 12. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ (—á–µ—Ä–µ–∑ –õ–ö)
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–æ–µ–∫—Ç—É:**
- –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç: `/docs/TOCHKA_BANK_MIGRATION_ANALYSIS.md`
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `/docs/TOCHKA_BANK_ACQUIRING_SETUP.md`

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 8 –¥–µ–∫–∞–±—Ä—è 2024  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude)  
**–°—Ç–∞—Ç—É—Å:** üìã –û–∂–∏–¥–∞–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–ü—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é**
2. üìß **–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞** –∏ –ø–æ–ª—É—á–∏—Ç—å credentials
3. üìÑ **–ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API** –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
4. üí¨ **–û–±—Å—É–¥–∏—Ç—å** –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤–Ω–µ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
5. üöÄ **–ù–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É** –ø–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–º—É –ø–ª–∞–Ω—É

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? –ù–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç, –∏ –º—ã –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üéØ

