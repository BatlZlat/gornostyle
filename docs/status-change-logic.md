# –õ–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

## üîÑ –ö–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫?

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

–°—Ç–∞—Ç—É—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ **cron –∑–∞–¥–∞—á—É**, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç**.

#### –ü—Ä–æ—Ü–µ—Å—Å:

1. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (`src/services/scheduler.js`)**
   - –ó–∞–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ: `*/30 * * * *` (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
   - –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞: `Asia/Yekaterinburg` (–ê–∑–∏—è/–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥)
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç: `src/scripts/complete-past-group-sessions.js`

2. **–°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (`src/scripts/complete-past-group-sessions.js`)**
   
   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:

   **–î–ª—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞ (–≥—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏):**
   ```sql
   UPDATE training_sessions
   SET status = 'completed', updated_at = NOW()
   WHERE (slope_type IS NULL OR slope_type = 'simulator')
     AND training_type = TRUE
     AND status = 'scheduled'
     AND (
       session_date < CURRENT_DATE
       OR (session_date = CURRENT_DATE AND end_time::time < CURRENT_TIME)
     )
   ```

   **–î–ª—è –∑–∏–º–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–≥—Ä—É–ø–ø–æ–≤—ã–µ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ):**
   ```sql
   UPDATE training_sessions
   SET status = 'completed', updated_at = NOW()
   WHERE slope_type =—à–∞—è 'natural_slope'
     AND status = 'scheduled'
     AND (
       session_date < CURRENT_DATE::date
       OR (session_date = CURRENT_DATE::date AND end_time::time < CURRENT_TIME::time)
     )
   ```

### –£—Å–ª–æ–≤–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

–°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è —Å `scheduled` ‚Üí `completed`, –µ—Å–ª–∏:

1. ‚úÖ –î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ < —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã **–ò–õ–ò**
2. ‚úÖ –î–∞—Ç–∞ = —Å–µ–≥–æ–¥–Ω—è **–ò** –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è < —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–í–∞–∂–Ω–æ:** –ë—É–¥—É—â–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–¥–∞–∂–µ —Å –¥–∞—Ç–æ–π –≤ –±—É–¥—É—â–µ–º) **–ù–ï** –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ –æ—à–∏–±–∫–µ –∏–º–µ–ª–∏ —Å—Ç–∞—Ç—É—Å `completed`.

### –°—Ç–∞—Ç—É—Å—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

- **`scheduled`** ‚Äî –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (–µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–∞)
- **`completed`** ‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (—É–∂–µ –ø—Ä–æ—à–ª–∞)
- **`cancelled`** ‚Äî –û—Ç–º–µ–Ω–µ–Ω–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞

### –ì–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É?

#### –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ (`/api/schedule/admin`)
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ –í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `scheduled`
- ‚úÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `completed`, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–∏ (–±—É–¥—É—â–∞—è –¥–∞—Ç–∞ –∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è, –Ω–æ –≤—Ä–µ–º—è –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–æ)

**–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- ‚ùå –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `completed`, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø—Ä–æ—à–ª–∏ –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏

#### –ê—Ä—Ö–∏–≤ (`/api/winter-trainings/archive`)
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ –í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø—Ä–æ—à–ª–∏ –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

### –†—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

–°—Ç–∞—Ç—É—Å —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑:
- API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (`PUT /api/winter-trainings/:id`)
- –ü—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –û—Ç–º–µ–Ω—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (—Å—Ç–∞—Ç—É—Å `cancelled`)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å:
```
[2025-10-29T22:30:00.000Z] –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
–ì—Ä—É–ø–ø–æ–≤—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ completed: 0
–ó–∏–º–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫–ª–æ–Ω) –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ completed: 1
–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ completed: 1
```

### –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ü–æ—á–µ–º—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ –±—É–¥—É—â—É—é –¥–∞—Ç—É –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å `completed`?**
A: –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∏–∑-–∑–∞:
   - –†—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
   - –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∏–∫–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
   - –†–∞–∑–Ω–∏—Ü—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –ë–î –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
   
   **–†–µ—à–µ–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –Ω–µ –∏–∑–º–µ–Ω–∏—Ç –±—É–¥—É—â–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–ø–∏—Å–∫–µ –æ–Ω–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å?**
A: –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é:
```bash
node src/scripts/complete-past-group-sessions.js
```

**Q: –ú–æ–≥—É –ª–∏ —è –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é?**
A: –î–∞, —á–µ—Ä–µ–∑ API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

