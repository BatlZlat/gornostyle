# 📊 СТАТУС ПРОЕКТА: СЛУЖБА ИНСТРУКТОРОВ КУЛИГИ ГОРНОСТАЙЛ72

**Дата начала:** 9 ноября 2025  
**Дедлайн:** 23 ноября 2025 (2 недели)  
**Оставшееся время:** 13 дней  
**Прогресс:** 17% (3/18 задач)

---

## ✅ ЗАВЕРШЕНО (Сессия 1 - 9 ноября)

### 1. База данных
- ✅ Спроектировано 7 таблиц с префиксом `kuliga_*`
- ✅ Миграция создана: `src/db/migrations/027_create_kuliga_system.sql`
- ✅ Миграция успешно применена (скрипт: `scripts/run-kuliga-migration.js`)
- ✅ `schema.sql` обновлен с полной документацией

**Таблицы:**
```sql
kuliga_clients           -- Клиенты (ФИО + телефон + telegram_id)
kuliga_instructors       -- Инструкторы (управляются админом)
kuliga_schedule_slots    -- Временные слоты расписания
kuliga_group_trainings   -- Групповые тренировки
kuliga_bookings          -- Бронирования (индивидуальные + групповые)
kuliga_transactions      -- Транзакции через Tinkoff Acquiring
kuliga_admin_settings    -- Настройки (процент админа, время проверки)
```

### 2. Документация
- ✅ **Инструкция по Tinkoff Acquiring:** `docs/TINKOFF_ACQUIRING_SETUP.md`
  - Регистрация счета для самозанятых
  - Получение API ключей (TerminalKey + Password)
  - Примеры интеграции (инициализация, webhook, возвраты)
  - Чеклист перед запуском

### 3. Планирование
- ✅ TODO-лист создан (18 задач)
- ✅ План работы в `.cursor/scratchpad.md`

---

## 🎯 СЛЕДУЮЩИЕ ШАГИ (Приоритет)

### 🔥 НЕДЕЛЯ 1 (10-16 ноября) - КРИТИЧНЫЙ ФУНКЦИОНАЛ

#### 1. Лендинг `/instruktora-kuliga` (2-3 дня)
**Файлы для создания:**
- `views/kuliga-landing.ejs` - Главная страница
- `public/css/kuliga.css` - Стили (в стиле Горностайл72)
- `src/routes/kuliga-public.js` - Routes для публичных страниц

**Структура лендинга:**
```
┌─────────────────────────────────────┐
│ ШАПКА (Лого + Название)             │
├─────────────────────────────────────┤
│ ПРАЙС (из winter_prices)            │
├─────────────────────────────────────┤
│ СПИСОК ГРУПП                        │
│ - Новички Лыжники 12+               │
│ - Новички Сноубордисты 14+          │
├─────────────────────────────────────┤
│ ИНСТРУКТОРЫ                         │
│ ┌───────────────────────────────┐   │
│ │ Фото | ФИО | Специализация   │   │
│ │ Календарь расписания (неделя) │   │
│ │ [Зеленые][Серые][Красные]     │   │
│ └───────────────────────────────┘   │
└─────────────────────────────────────┘
```

**Mobile-first:**
- Календарь свайпится влево/вправо
- Дни недели + числа сверху
- Временные слоты снизу (цветовая индикация)

**SEO:**
```html
<title>Обучение горным лыжам и сноуборду на Кулиге | Горностайл72</title>
<meta name="description" content="Профессиональные инструкторы по горным лыжам и сноуборду на базе отдыха Кулига. Групповые и индивидуальные занятия.">
<meta name="keywords" content="обучение горным лыжам Кулига, инструктор сноуборда Тюмень, горнолыжная школа Кулига">
```

#### 2. Интеграция с Tinkoff Acquiring (1-2 дня)
**Файлы для создания:**
- `src/services/kuliga-payment-service.js` - Сервис для работы с Tinkoff API
- `src/routes/kuliga-payment.js` - Routes для платежей

**Endpoints:**
```javascript
POST /api/kuliga/payment/init           // Инициализация платежа
POST /api/kuliga/payment/callback       // Webhook от Тинькофф
GET  /api/kuliga/payment/status/:id     // Проверка статуса
POST /api/kuliga/payment/refund         // Возврат средств
```

**Использовать:**
- Инструкцию из `docs/TINKOFF_ACQUIRING_SETUP.md`
- Примеры кода из инструкции (готовы к копированию)

#### 3. Форма бронирования (2-3 дня)
**Файлы для создания:**
- `views/kuliga-booking.ejs` - Форма бронирования
- `src/routes/kuliga-booking.js` - Routes для бронирования

**Форма должна включать:**
- ФИО (обязательно)
- Телефон (обязательно)
- Email (опционально)
- Количество участников (для семейного бронирования)
- Имена всех участников (если > 1)
- Чекбокс согласия на обработку ПД (обязательно)

**Текст согласия:**
```
☑ Я согласен(а) на обработку моих персональных данных (ФИО, телефон, email) 
и даю согласие на использование фото/видео с тренировок в рекламных целях 
(социальные сети, мессенджеры). [Политика конфиденциальности]
```

**Предупреждение для групповых:**
```
⚠️ Если тренировка не наберет минимальное количество участников 
до 22:00 дня перед тренировкой, деньги будут автоматически возвращены 
на ваш счет в течение 1-3 рабочих дней.
```

#### 4. Telegram-боты (2-3 дня)
**Файлы для создания:**
- `src/bot/kuliga-client-bot.js` - Бот для клиентов
- `src/bot/kuliga-instructor-bot.js` - Бот для инструкторов

**Функционал:**
- **Клиентский бот:**
  - Регистрация по ФИО + телефону (из оплаты)
  - Уведомления о подтверждении бронирования
  - Напоминания за день до тренировки
  - Уведомления об отмене (с возвратом)

- **Инструкторский бот:**
  - Самостоятельная регистрация
  - Напоминания о предстоящих тренировках
  - Уведомления о новых бронированиях
  - Только активным инструкторам

#### 5. Автоматика (1 день)
**Файлы для создания:**
- `scripts/check-kuliga-groups.js` - Проверка групповых тренировок

**Cron-задача:**
```javascript
// Запускается каждый день в 22:00
// Проверяет все групповые тренировки на завтра
// Если участников < min_participants:
//   - Статус → cancelled
//   - Автовозврат всем участникам
//   - Уведомления клиентам и инструктору
```

---

## ⏸️ НЕДЕЛЯ 2 (17-23 ноября) - АДМИНКА И ТЕСТИРОВАНИЕ

### 1. Админ-панель (2-3 дня)
- Управление инструкторами
- Финансовая отчетность
- Настройки процентов

### 2. Личный кабинет инструктора (2-3 дня)
- Управление расписанием
- Создание групповых тренировок
- Статистика заработка

### 3. Тестирование и запуск (2-3 дня)
- Полное тестирование всех функций
- Тестирование на мобильных (320px, 375px, 414px)
- Деплой на продакшн

---

## 📁 ВАЖНЫЕ ФАЙЛЫ

### Документация
```
docs/TINKOFF_ACQUIRING_SETUP.md         -- Инструкция по Тинькофф (готова!)
docs/KULIGA_PROJECT_STATUS.md           -- Этот файл
.cursor/scratchpad.md                   -- Детальный план
```

### База данных
```
src/db/migrations/027_create_kuliga_system.sql  -- Миграция
src/models/schema.sql                           -- Обновленная схема
scripts/run-kuliga-migration.js                 -- Скрипт запуска
```

### Для создания в следующей сессии
```
views/kuliga-landing.ejs                -- Главная страница
views/kuliga-booking.ejs                -- Форма бронирования
public/css/kuliga.css                   -- Стили
src/routes/kuliga-public.js             -- Публичные routes
src/routes/kuliga-payment.js            -- Платежи
src/routes/kuliga-booking.js            -- Бронирование
src/services/kuliga-payment-service.js  -- Сервис Tinkoff
src/bot/kuliga-client-bot.js            -- Бот клиентов
src/bot/kuliga-instructor-bot.js        -- Бот инструкторов
scripts/check-kuliga-groups.js          -- Проверка групп
```

---

## 🎨 ДИЗАЙН (ФИРМЕННЫЙ СТИЛЬ ГОРНОСТАЙЛ72)

### Цвета
```css
--primary-blue: #3498db;      /* Основной синий */
--dark-blue: #2980b9;         /* Темный синий */
--navy: #003d82;              /* Темно-синий (акцент) */
--light-blue: #1e90ff;        /* Светло-синий */
--white: #ffffff;             /* Белый */
--gray-light: #f8f9fa;        /* Светло-серый (фон) */
--gray: #7f8c8d;              /* Серый (текст) */
--gray-dark: #2c3e50;         /* Темно-серый (заголовки) */
```

### Статусы слотов
```css
--slot-available: #27ae60;    /* Зеленый = свободен */
--slot-booked: #e74c3c;       /* Красный = занят */
--slot-group: #3498db;        /* Голубой = групповая */
--slot-blocked: #95a5a6;      /* Серый = не работает */
```

### Шрифты
```css
font-family: 'Roboto', 'Inter', -apple-system, sans-serif;
```

---

## 🔗 ПОЛЕЗНЫЕ ССЫЛКИ

- **Основной сайт:** https://gornostyle72.ru/
- **Кулига-Клуб:** https://www.kuliga-park.ru/
- **Tinkoff Acquiring API:** https://www.tinkoff.ru/kassa/develop/api/
- **Tinkoff для самозанятых:** https://www.tinkoff.ru/business/self-employed/

---

## ⚠️ ВАЖНЫЕ ЗАМЕЧАНИЯ

1. **Mobile-first:** Приоритет на мобильную версию (большинство клиентов с телефонов)
2. **SEO:** Внедрять с самого начала (meta-теги, schema.org)
3. **Безопасность:** Все платежи через HTTPS, валидация на сервере
4. **Telegram-боты:** Создать НОВЫЕ боты (отдельные от основной системы)
5. **Возвраты:** Правильное оформление через Tinkoff API (не в обороте самозанятого)
6. **Время проверки:** 22:00 (настраивается в `kuliga_admin_settings`)

---

## 💡 СОВЕТЫ ДЛЯ РАЗРАБОТКИ

### Начните с лендинга
- Скопируйте структуру из `views/certificate-purchase.ejs`
- Используйте существующие стили `/css/style.css`, `/css/mobile.css`
- Добавьте свои стили в `/css/kuliga.css`

### Тестирование платежей
- Используйте тестовые ключи из инструкции Tinkoff
- Тестовая карта: `4300 0000 0000 0777`
- Для локальной разработки используйте `ngrok` для webhook

### Структура routes
```javascript
// Пример структуры
src/routes/kuliga-public.js      // GET /instruktora-kuliga
src/routes/kuliga-booking.js     // POST /api/kuliga/booking
src/routes/kuliga-payment.js     // POST /api/kuliga/payment/*
```

### Подключение в app.js
```javascript
const kuligaPublic = require('./routes/kuliga-public');
const kuligaBooking = require('./routes/kuliga-booking');
const kuligaPayment = require('./routes/kuliga-payment');

app.use('/', kuligaPublic);
app.use('/api/kuliga', kuligaBooking);
app.use('/api/kuliga', kuligaPayment);
```

---

## ✅ ЧЕКЛИСТ ПЕРЕД ЗАПУСКОМ

- [ ] Лендинг создан и адаптирован под мобильные
- [ ] Tinkoff Acquiring интегрирован (тестовые ключи работают)
- [ ] Форма бронирования с согласием на ПД
- [ ] Семейное бронирование (несколько человек)
- [ ] Предупреждение об автоотмене групповых
- [ ] Telegram-боты созданы (клиенты + инструкторы)
- [ ] Cron-задача проверки групп в 22:00
- [ ] Админ-панель (управление инструкторами)
- [ ] ЛК инструктора (расписание + статистика)
- [ ] SEO оптимизация (meta-теги, schema.org)
- [ ] Ссылка на основном сайте gornostyle72.ru
- [ ] Тестирование на мобильных (320-414px)
- [ ] Тестирование всего flow (бронирование → оплата → уведомления)
- [ ] Замена тестовых ключей Tinkoff на боевые
- [ ] Деплой на продакшн

---

**Удачи! У нас все получится! 🚀**

*Следующая сессия: Создание лендинга и интеграция с Tinkoff*

