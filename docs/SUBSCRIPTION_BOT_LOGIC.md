# üé´ –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –°–ò–°–¢–ï–ú–ê –ê–ë–û–ù–ï–ú–ï–ù–¢–û–í –í –ë–û–¢–ï

**–î–∞—Ç–∞:** 1 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üìã –û–ë–©–ò–ô –ü–†–ò–ù–¶–ò–ü –†–ê–ë–û–¢–´

–ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –∫—É–ø–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–Ω—è—Ç–∏–π (5 –∏–ª–∏ 10) —Å–æ —Å–∫–∏–¥–∫–æ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—Ä–æ–∫–∞. –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã –ø—Ä–∏–º–µ–Ω–∏–º—ã —Ç–æ–ª—å–∫–æ –∫ **—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–º –≥—Ä—É–ø–ø–∞–º** –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–∫–ª–æ–Ω–µ (–ö—É–ª–∏–≥–∞ –ü–∞—Ä–∫).

**–¢–µ–∫—É—â–∏–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã:**
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π):** 7650‚ÇΩ, —Å–∫–∏–¥–∫–∞ 10%, —Ü–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ 1530‚ÇΩ, —Å—Ä–æ–∫ 60 –¥–Ω–µ–π
- **–ü—Ä–µ–º–∏—É–º (10 –∑–∞–Ω—è—Ç–∏–π):** 13600‚ÇΩ, —Å–∫–∏–¥–∫–∞ 20%, —Ü–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ 1360‚ÇΩ, —Å—Ä–æ–∫ 90 –¥–Ω–µ–π

**–û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ –≤ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø–µ:** 1700‚ÇΩ

---

## üõí –ß–ê–°–¢–¨ 1: –ü–û–ö–£–ü–ö–ê –ê–ë–û–ù–ï–ú–ï–ù–¢–ê

### –®–∞–≥ 1: –î–æ—Å—Ç—É–ø –∫ –ø–æ–∫—É–ø–∫–µ

**–ú–µ—Å—Ç–æ –≤ –º–µ–Ω—é:** "üèîÔ∏è –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫–ª–æ–Ω" ‚Üí "üí∞ –ö—É–ø–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç"

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "üèîÔ∏è –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫–ª–æ–Ω", –µ–º—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–µ–Ω—é:
```
üèîÔ∏è –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫–ª–æ–Ω (–ö—É–ª–∏–≥–∞ –ü–∞—Ä–∫)

–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:

üë• –ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
üë§ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
üí∞ –ö—É–ø–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç
üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é
```

### –®–∞–≥ 2: –ü–æ–∫–∞–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏—è:** `showAvailableSubscriptions(chatId)`

**–õ–æ–≥–∏–∫–∞:**
1. –ó–∞–ø—Ä–æ—Å –∫ API: `GET /api/natural-slope-subscriptions/types` (—Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ)
2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ `is_active = true`
3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üé´ *–î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã:*

*1. –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)*
üí∞ –¶–µ–Ω–∞: 7,650‚ÇΩ
üíµ –¶–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ: 1,530‚ÇΩ (—Å–∫–∏–¥–∫–∞ 10%)
üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 60 –¥–Ω–µ–π
üí° –í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ: 850‚ÇΩ

*2. –ü—Ä–µ–º–∏—É–º (10 –∑–∞–Ω—è—Ç–∏–π)*
üí∞ –¶–µ–Ω–∞: 13,600‚ÇΩ
üíµ –¶–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ: 1,360‚ÇΩ (—Å–∫–∏–¥–∫–∞ 20%)
üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 90 –¥–Ω–µ–π
üí° –í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ: 3,400‚ÇΩ

*–û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞:* 1,700‚ÇΩ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ

–í—ã–±–µ—Ä–∏—Ç–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç:
```

**–ö–Ω–æ–ø–∫–∏:**
```
[1Ô∏è‚É£ –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)]
[2Ô∏è‚É£ –ü—Ä–µ–º–∏—É–º (10 –∑–∞–Ω—è—Ç–∏–π)]
[üîô –ù–∞–∑–∞–¥]
```

### –®–∞–≥ 3: –í—ã–±–æ—Ä –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞

**–§—É–Ω–∫—Ü–∏—è:** `handleSubscriptionSelection(chatId, subscriptionTypeId)`

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:** `state.step = 'subscription_selection'`

**–õ–æ–≥–∏–∫–∞:**
1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ –≤ `state.data.subscription_type_id`
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∫—É–ø–∫–µ

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üé´ *–í—ã–±—Ä–∞–Ω –∞–±–æ–Ω–µ–º–µ–Ω—Ç: –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)*

üìã *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:*
üí∞ –¶–µ–Ω–∞: 7,650‚ÇΩ
üíµ –¶–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ: 1,530‚ÇΩ (–≤–º–µ—Å—Ç–æ 1,700‚ÇΩ)
üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 60 –¥–Ω–µ–π
üéÅ –í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ: 850‚ÇΩ

üí≥ *–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:* 10,000‚ÇΩ

‚úÖ *–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏:*
‚Ä¢ 5 –∑–∞–Ω—è—Ç–∏–π –≤ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø–µ
‚Ä¢ –°—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 60 –¥–Ω–µ–π
‚Ä¢ –¶–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ: 1,530‚ÇΩ –≤–º–µ—Å—Ç–æ 1,700‚ÇΩ

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É?
```

**–ö–Ω–æ–ø–∫–∏:**
```
[‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É]
[‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

### –®–∞–≥ 4: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏

**–§—É–Ω–∫—Ü–∏—è:** `confirmSubscriptionPurchase(chatId)`

**–õ–æ–≥–∏–∫–∞:**
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞:**
   ```sql
   SELECT balance FROM wallets WHERE client_id = $1
   ```
   –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å < —Ü–µ–Ω–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ ‚Üí –æ—à–∏–±–∫–∞

2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–î:**
   ```sql
   BEGIN;
   
   -- –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –∫–æ—à–µ–ª—å–∫–∞
   UPDATE wallets SET balance = balance - $price 
   WHERE client_id = $client_id;
   
   -- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –ø–æ–∫—É–ø–∫–µ
   INSERT INTO transactions (wallet_id, amount, type, description)
   VALUES ($wallet_id, -$price, 'payment', '–ü–æ–∫—É–ø–∫–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞: [–ù–∞–∑–≤–∞–Ω–∏–µ]');
   
   -- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
   INSERT INTO natural_slope_subscriptions (
       client_id, subscription_type_id, remaining_sessions,
       status, expires_at, total_paid
   ) VALUES (
       $client_id, $subscription_type_id, $sessions_count,
       'active', CURRENT_TIMESTAMP + INTERVAL '$validity_days days', $price
   );
   
   COMMIT;
   ```

3. **–†–∞—Å—á–µ—Ç –¥–∞—Ç—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è:**
   - `expires_at = NOW() + validity_days`

4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É:**
   ```
   ‚úÖ *–ê–±–æ–Ω–µ–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω!*
   
   üé´ *–¢–∏–ø:* –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
   üí∞ *–û–ø–ª–∞—á–µ–Ω–æ:* 7,650‚ÇΩ
   üìÖ *–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:* –¥–æ 31.12.2025 (60 –¥–Ω–µ–π)
   üéØ *–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π:* 5
   
   üí° *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
   ‚Ä¢ –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –≥—Ä—É–ø–ø–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É (—Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞)
   ‚Ä¢ –í–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç
   ‚Ä¢ –° –≤–∞—Å —Å–ø–∏—à–µ—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ, –∞ –Ω–µ –¥–µ–Ω—å–≥–∏
   
   üí≥ *–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ:* 2,350‚ÇΩ
   ```

5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:**
   ```
   üé´ *–ù–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞!*
   
   üë§ *–ö–ª–∏–µ–Ω—Ç:* –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á
   üì± *–¢–µ–ª–µ—Ñ–æ–Ω:* +79123456789
   üé´ *–¢–∏–ø:* –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
   üí∞ *–°—É–º–º–∞:* 7,650‚ÇΩ
   üìÖ *–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:* –¥–æ 31.12.2025
   üéØ *–ó–∞–Ω—è—Ç–∏–π:* 5
   ```

### –®–∞–≥ 5: –û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤:**
```
‚ùå *–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!*

üí∞ *–¢—Ä–µ–±—É–µ—Ç—Å—è:* 7,650‚ÇΩ
üí≥ *–í–∞—à –±–∞–ª–∞–Ω—Å:* 5,000‚ÇΩ
üìä *–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç:* 2,650‚ÇΩ

–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
```

**–ö–Ω–æ–ø–∫–∏:**
```
[üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å]
[üîô –ù–∞–∑–∞–¥]
```

---

## üéø –ß–ê–°–¢–¨ 2: –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ê–ë–û–ù–ï–ú–ï–ù–¢–ê

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏

**–ú–µ—Å—Ç–æ:** –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –≥—Ä—É–ø–ø–æ–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –≤ –ö—É–ª–∏–≥–∞ –ü–∞—Ä–∫

**–§—É–Ω–∫—Ü–∏—è:** `checkActiveSubscriptions(clientId)`

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT 
    ns.id,
    ns.remaining_sessions,
    ns.expires_at,
    st.name,
    st.sessions_count,
    st.price_per_session
FROM natural_slope_subscriptions ns
JOIN natural_slope_subscription_types st ON ns.subscription_type_id = st.id
WHERE ns.client_id = $1
  AND ns.status = 'active'
  AND ns.remaining_sessions > 0
  AND ns.expires_at > NOW()
ORDER BY ns.expires_at ASC
LIMIT 1;
```

**–£—Å–ª–æ–≤–∏—è:**
- ‚úÖ `status = 'active'`
- ‚úÖ `remaining_sessions > 0`
- ‚úÖ `expires_at > NOW()`
- ‚úÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø–æ–π (`winter_training_type = 'sport_group'`)

### –®–∞–≥ 2: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç

**–§—É–Ω–∫—Ü–∏—è:** `offerSubscriptionUsage(chatId, trainingId, subscriptionId)`

**–í–ê–ñ–ù–û: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏ –¥–µ–Ω–µ–≥, –∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞**

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤
3. **–ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç** ‚Üí **–í–°–ï–ì–î–ê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞**
4. **–ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞** ‚Üí –æ–±—ã—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞

**–ü—Ä–∞–≤–∏–ª–æ:** 
- ‚úÖ **–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –í–°–ï–ì–î–ê –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±–æ—Ä:**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç (—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è)
  - –ò–ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å –æ–±—ã—á–Ω–æ–π —Ü–µ–Ω–æ–π (—Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –±–∞–ª–∞–Ω—Å–∞)
- ‚úÖ **–ö–ª–∏–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç**, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ù–ï –∑–∞–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - —ç—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç –ò –¥–µ–Ω—å–≥–∏):**
```
üé´ *–£ –≤–∞—Å –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç!*

üìã *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–±–æ–Ω–µ–º–µ–Ω—Ç–µ:*
üé´ –¢–∏–ø: –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
üéØ –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π: 3
üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 31.12.2025

üí≥ *–í–∞—à –±–∞–ª–∞–Ω—Å:* 10,000‚ÇΩ

üí° *–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:*

*–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç* üé´
‚Ä¢ –° –≤–∞—Å —Å–ø–∏—à–µ—Ç—Å—è 1 –∑–∞–Ω—è—Ç–∏–µ (–Ω–µ –¥–µ–Ω—å–≥–∏!)
‚Ä¢ –¶–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ: 1,530‚ÇΩ (–æ–±—ã—á–Ω–∞—è: 1,700‚ÇΩ)
‚Ä¢ –í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ: 170‚ÇΩ
‚Ä¢ –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ: 10,000‚ÇΩ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

*–í–∞—Ä–∏–∞–Ω—Ç 2: –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å* üí∞
‚Ä¢ –° –≤–∞—Å —Å–ø–∏—à–µ—Ç—Å—è: 1,700‚ÇΩ —Å –±–∞–ª–∞–Ω—Å–∞
‚Ä¢ –ê–±–æ–Ω–µ–º–µ–Ω—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º
‚Ä¢ –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ: 8,300‚ÇΩ

–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
```

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç —Å–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç):**
```
üé´ *–£ –≤–∞—Å –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç!*

‚ö†Ô∏è *–í–Ω–∏–º–∞–Ω–∏–µ: –ê–±–æ–Ω–µ–º–µ–Ω—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π!*

üìã *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–±–æ–Ω–µ–º–µ–Ω—Ç–µ:*
üé´ –¢–∏–ø: –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
üéØ –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π: 3
üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 31.12.2025 (–æ—Å—Ç–∞–ª–æ—Å—å 7 –¥–Ω–µ–π!)

üí≥ *–í–∞—à –±–∞–ª–∞–Ω—Å:* 10,000‚ÇΩ

üí° *–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç:*
‚Ä¢ –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
‚Ä¢ –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è –ø—Ä–æ–ø–∞–¥—É—Ç
‚Ä¢ –° –≤–∞—Å —Å–ø–∏—à–µ—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ (–Ω–µ –¥–µ–Ω—å–≥–∏!)
‚Ä¢ –í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ: 170‚ÇΩ

*–ò–ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å:*
üí∞ 1,700‚ÇΩ —Å –±–∞–ª–∞–Ω—Å–∞

–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
```

**–ö–Ω–æ–ø–∫–∏:**
```
[üé´ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç]
[üí∞ –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å]
[‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

### –®–∞–≥ 2.1: –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞

**–õ–æ–≥–∏–∫–∞:** –û–±—ã—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞ (–∫–∞–∫ —Å–µ–π—á–∞—Å)

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üìã *–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏:*

... (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ) ...

üí∞ *–°—Ç–æ–∏–º–æ—Å—Ç—å:* 1,700‚ÇΩ
üí≥ *–í–∞—à –±–∞–ª–∞–Ω—Å:* 10,000‚ÇΩ
üíµ *–û—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:* 8,300‚ÇΩ

‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è?
```

**–ö–Ω–æ–ø–∫–∏:**
```
[‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è]
[‚ùå –û—Ç–º–µ–Ω–∏—Ç—å]
```

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞

**–§—É–Ω–∫—Ü–∏—è:** `useSubscriptionForTraining(chatId, trainingId, subscriptionId)`

**–õ–æ–≥–∏–∫–∞:**
1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–î:**
   ```sql
   BEGIN;
   
   -- –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–Ω—è—Ç–∏–π
   UPDATE natural_slope_subscriptions
   SET remaining_sessions = remaining_sessions - 1,
       status = CASE 
           WHEN remaining_sessions - 1 = 0 THEN 'used'
           ELSE 'active'
       END
   WHERE id = $subscription_id;
   
   -- –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
   SELECT price, max_participants FROM training_sessions WHERE id = $training_id;
   
   -- –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   INSERT INTO natural_slope_subscription_usage (
       subscription_id, training_session_id,
       original_price, subscription_price, savings
   ) VALUES (
       $subscription_id, $training_id,
       1700.00, -- –û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞
       1530.00, -- –¶–µ–Ω–∞ –ø–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—É
       170.00   -- –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ
   );
   
   -- –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   INSERT INTO session_participants (session_id, client_id, status)
   VALUES ($training_id, $client_id, 'confirmed');
   
   COMMIT;
   ```

2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É:**
   ```
   ‚úÖ *–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞!*
   
   üìã *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:*
   üìÖ –î–∞—Ç–∞: 15.11.2025
   ‚è∞ –í—Ä–µ–º—è: 17:30
   üèîÔ∏è –ú–µ—Å—Ç–æ: –ö—É–ª–∏–≥–∞ –ü–∞—Ä–∫
   üë• –ì—Ä—É–ø–ø–∞: –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞
   
   üé´ *–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–±–æ–Ω–µ–º–µ–Ω—Ç:*
   ‚Ä¢ –¢–∏–ø: –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
   ‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π: 2
   ‚Ä¢ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 31.12.2025
   ‚Ä¢ –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ: 170‚ÇΩ
   
   üéø *–£–¥–∞—á–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!*
   ```

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:**
   ```
   üé´ *–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–±–æ–Ω–µ–º–µ–Ω—Ç!*
   
   üë§ *–ö–ª–∏–µ–Ω—Ç:* –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á
   üì± *–¢–µ–ª–µ—Ñ–æ–Ω:* +79123456789
   üé´ *–¢–∏–ø –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞:* –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
   üéØ *–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π:* 2
   
   üìã *–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞:*
   üìÖ –î–∞—Ç–∞: 15.11.2025
   ‚è∞ –í—Ä–µ–º—è: 17:30
   üë• –ì—Ä—É–ø–ø–∞: –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞
   
   üí∞ *–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ:* 170‚ÇΩ (–æ–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞: 1,700‚ÇΩ)
   ```

### –®–∞–≥ 4: –û–±—ã—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ (–±–µ–∑ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞)

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç "üí∞ –û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å", –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤)
2. –°–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (1,700‚ÇΩ) —Å –±–∞–ª–∞–Ω—Å–∞
3. –ó–∞–ø–∏—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–í–∞–∂–Ω–æ:** 
- ‚úÖ –ê–±–æ–Ω–µ–º–µ–Ω—Ç **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**, –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –∏–¥–µ—Ç **—Å –±–∞–ª–∞–Ω—Å–∞** (–¥–µ–Ω—å–≥–∏)
- ‚úÖ –ê–±–æ–Ω–µ–º–µ–Ω—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è: 0‚ÇΩ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –æ–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞)

**–ü—Ä–∏–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
```sql
BEGIN;

-- –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –±–∞–ª–∞–Ω—Å–∞
UPDATE wallets SET balance = balance - 1700.00 
WHERE client_id = $client_id;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
INSERT INTO transactions (wallet_id, amount, type, description)
VALUES ($wallet_id, -1700.00, 'payment', '–ì—Ä—É–ø–ø–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –ö—É–ª–∏–≥–∞ –ü–∞—Ä–∫');

-- –ó–∞–ø–∏—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–ë–ï–ó –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞)
INSERT INTO session_participants (session_id, client_id, status)
VALUES ($training_id, $client_id, 'confirmed');

COMMIT;
```

---

## üìä –ß–ê–°–¢–¨ 3: –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ê–ë–û–ù–ï–ú–ï–ù–¢–û–í

### –í —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–∏ –∑–∞–ø–∏—Å–∏"

**–§—É–Ω–∫—Ü–∏—è:** `showMyBookings(chatId)` - –æ–±–Ω–æ–≤–∏—Ç—å

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã:
   ```sql
   SELECT 
       ns.*,
       st.name,
       st.sessions_count,
       st.price_per_session,
       st.validity_days
   FROM natural_slope_subscriptions ns
   JOIN natural_slope_subscription_types st ON ns.subscription_type_id = st.id
   WHERE ns.client_id = $1
     AND ns.status = 'active'
     AND ns.remaining_sessions > 0
     AND ns.expires_at > NOW()
   ORDER BY ns.expires_at ASC;
   ```

2. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª:
   ```
   üé´ *–ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã:*
   
   *1. –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)*
   üéØ –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π: 3 –∏–∑ 5
   üìÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: –¥–æ 31.12.2025 (–æ—Å—Ç–∞–ª–æ—Å—å 45 –¥–Ω–µ–π)
   üíµ –¶–µ–Ω–∞ –∑–∞ –∑–∞–Ω—è—Ç–∏–µ: 1,530‚ÇΩ
   ```

### –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

**–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª:** "üé´ –ú–æ–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã"

**–ö–Ω–æ–ø–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é:**
```
[üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É]
[üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏]
[üé´ –ú–æ–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã] ‚Üê –ù–û–í–û–ï
[üí¨ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –±–æ—Ç–æ–º]
[‚öôÔ∏è –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è]
```

**–§—É–Ω–∫—Ü–∏—è:** `showMySubscriptions(chatId)`

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º:**
- –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã
- –ò—Å—Ç–µ–∫—à–∏–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üîî –ß–ê–°–¢–¨ 4: –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø

### –û—Å—Ç–∞–ª–æ—Å—å 3 –∑–∞–Ω—è—Ç–∏—è
**–ö–æ–≥–¥–∞:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å 3 –∑–∞–Ω—è—Ç–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```
üé´ *–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –∞–±–æ–Ω–µ–º–µ–Ω—Ç–µ*

–£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å *3 –∑–∞–Ω—è—Ç–∏—è* –≤ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–µ "–°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)".

üìÖ *–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:* –¥–æ 31.12.2025
üí° *–°–æ–≤–µ—Ç:* –ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∑–∞—Ä–∞–Ω–µ–µ!
```

### –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
**–ö–æ–≥–¥–∞:** –ó–∞ 7 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞

**Cron –∑–∞–¥–∞—á–∞:** –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**SQL:**
```sql
SELECT * FROM natural_slope_subscriptions
WHERE status = 'active'
  AND remaining_sessions > 0
  AND expires_at BETWEEN NOW() AND NOW() + INTERVAL '7 days'
  AND expires_at > NOW() + INTERVAL '6 days';
```

**–ü—Ä–∏–º–µ—Ä:**
```
‚ö†Ô∏è *–í–∞—à –∞–±–æ–Ω–µ–º–µ–Ω—Ç —Å–∫–æ—Ä–æ –∏—Å—Ç–µ—á–µ—Ç!*

üé´ *–¢–∏–ø:* –°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)
üéØ *–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–Ω—è—Ç–∏–π:* 2
üìÖ *–ò—Å—Ç–µ–∫–∞–µ—Ç:* —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π (31.12.2025)

üí° *–£—Å–ø–µ–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞!*
```

### –ê–±–æ–Ω–µ–º–µ–Ω—Ç –∏—Å—Ç–µ–∫
**–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞, –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–õ–æ–≥–∏–∫–∞:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ cron: `status = 'expired'`
2. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```
‚ùå *–ê–±–æ–Ω–µ–º–µ–Ω—Ç –∏—Å—Ç–µ–∫*

–í–∞—à –∞–±–æ–Ω–µ–º–µ–Ω—Ç "–°—Ç–∞–Ω–¥–∞—Ä—Ç (5 –∑–∞–Ω—è—Ç–∏–π)" –∏—Å—Ç–µ–∫ 31.12.2025.

üéØ *–û—Å—Ç–∞–ª–æ—Å—å –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π:* 2

üí° *–ß—Ç–æ –¥–µ–ª–∞—Ç—å:*
‚Ä¢ –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç
‚Ä¢ –û–ø–ª–∞—Ç–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –æ–±—ã—á–Ω–æ–π —Ü–µ–Ω–æ–π

[üí∞ –ö—É–ø–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç]
[üîô –ù–∞–∑–∞–¥]
```

---

## üõ°Ô∏è –ó–ê–©–ò–¢–ê –û–¢ –û–®–ò–ë–û–ö

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ:
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ
- ‚úÖ –ê–±–æ–Ω–µ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω (`is_active = true`)
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î –≤ BEGIN/COMMIT

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:
- ‚úÖ –ê–±–æ–Ω–µ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω (`status = 'active'`)
- ‚úÖ –ï—Å—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–Ω—è—Ç–∏—è (`remaining_sessions > 0`)
- ‚úÖ –ù–µ –∏—Å—Ç–µ–∫ —Å—Ä–æ–∫ (`expires_at > NOW()`)
- ‚úÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç (—Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞)
- ‚úÖ –£ –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–Ω—è—Ç–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤:
- **Cron –∑–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00)
  ```sql
  UPDATE natural_slope_subscriptions
  SET status = 'expired'
  WHERE status = 'active'
    AND expires_at < NOW();
  ```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –ò–°–¢–û–†–ò–Ø

### –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
- –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º:
  - –í—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤
  - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
  - –ö–æ–Ω–≤–µ—Ä—Å–∏—è

### –í –∏—Å—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
–¢–∞–±–ª–∏—Ü–∞ `natural_slope_subscription_usage` —Ö—Ä–∞–Ω–∏—Ç:
- –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–±–æ–Ω–µ–º–µ–Ω—Ç
- –ö–∞–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
- –û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ vs —Ü–µ–Ω–∞ –ø–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—É
- –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ

---

## üéØ –ò–¢–û–ì

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã:**
1. ‚úÖ **–ü–æ–∫—É–ø–∫–∞:** –ü–æ–∫–∞–∑ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ ‚Üí –í—ã–±–æ—Ä ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ ‚Üí –ü–æ–∫—É–ø–∫–∞
2. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö ‚Üí –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ‚Üí –°–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è
3. ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** –û—Å—Ç–∞–ª–æ—Å—å 3 –∑–∞–Ω—è—Ç–∏—è, –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π, –∏—Å—Ç–µ–∫
4. ‚úÖ **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –í "–ú–æ–∏ –∑–∞–ø–∏—Å–∏", –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:**
- üí∞ –≠–∫–æ–Ω–æ–º–∏—è: 10% –∏–ª–∏ 20%
- üéØ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è –Ω–∞ —Å—Ä–æ–∫
- üìÖ –ì–∏–±–∫–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞:**
- üíµ –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (–¥–µ–Ω—å–≥–∏ –ø–æ—Å—Ç—É–ø–∞—é—Ç —Å—Ä–∞–∑—É)
- üìä –ü–ª–∞–Ω–∏—Ä—É–µ–º–æ—Å—Ç—å (–∏–∑–≤–µ—Å—Ç–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤)
- üéÅ –õ–æ—è–ª—å–Ω–æ—Å—Ç—å (—Å—Ç–∏–º—É–ª –∫ –ø–æ–∫—É–ø–∫–µ)

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ üöÄ

