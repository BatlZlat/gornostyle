# Архитектура системы зимних тренировок на естественном склоне

## Общая схема системы

```
┌─────────────────────────────────────────────────────────────────┐
│                        КЛИЕНТСКИЙ БОТ                           │
├─────────────────────────────────────────────────────────────────┤
│  📝 Записаться на тренировку                                   │
│  ├── 🏔️ Естественный склон                                     │
│  │   ├── Выбор тренера                                          │
│  │   ├── Просмотр расписания тренера                           │
│  │   ├── Запись на групповую/индивидуальную тренировку         │
│  │   └── Начисление бонуса (500₽)                              │
│  └── 🎿 Горнолыжный тренажер                                    │
│      ├── Выбор тренажера (1/2)                                 │
│      ├── Существующая логика                                   │
│      └── Начисление бонуса (500₽)                              │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ТРЕНЕРСКАЯ ПАНЕЛЬ                            │
├─────────────────────────────────────────────────────────────────┤
│  🔧 Управление расписанием                                      │
│  ├── Установка доступности                                     │
│  ├── Создание групповых тренировок                             │
│  ├── Создание индивидуальных тренировок                       │
│  └── Просмотр записей клиентов                                 │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    АДМИН-ПАНЕЛЬ                                 │
├─────────────────────────────────────────────────────────────────┤
│  ⚙️ Управление системой бонусов                                │
│  ├── Включение/выключение акций                                │
│  ├── Настройка сумм бонусов                                    │
│  ├── Раздельное управление для тренажера/склона               │
│  └── Мониторинг выплат тренерам                                │
└─────────────────────────────────────────────────────────────────┘
```

## Схема базы данных

### Основные таблицы (расширенные)

```
training_sessions
├── id (PK)
├── simulator_id (FK) - для тренажера
├── trainer_id (FK) - для естественного склона
├── slope_type ('simulator' | 'natural_slope') - НОВОЕ ПОЛЕ
├── session_date
├── start_time
├── end_time
├── training_type (group/individual)
├── max_participants
├── price
└── status

schedule
├── id (PK)
├── simulator_id (FK) - для тренажера
├── trainer_id (FK) - НОВОЕ ПОЛЕ для естественного склона
├── date
├── start_time
├── end_time
├── is_booked
└── is_holiday

trainer_availability - НОВАЯ ТАБЛИЦА
├── id (PK)
├── trainer_id (FK)
├── date
├── start_time
├── end_time
├── is_available
├── max_group_size
└── hourly_rate
```

### Система бонусов

```
bonus_settings - НОВАЯ ТАБЛИЦА
├── id (PK)
├── name
├── slope_type ('simulator' | 'natural_slope' | 'both')
├── bonus_type ('registration' | 'booking' | 'referral')
├── bonus_amount
├── is_active
├── valid_from
└── valid_until

bonus_transactions - НОВАЯ ТАБЛИЦА
├── id (PK)
├── client_id (FK)
├── bonus_setting_id (FK)
├── amount
├── booking_id
├── booking_type
└── status ('pending' | 'approved' | 'cancelled')
```

### Система выплат тренерам

```
trainer_payments - НОВАЯ ТАБЛИЦА
├── id (PK)
├── trainer_id (FK)
├── training_session_id (FK)
├── amount
├── payment_type ('group_training' | 'individual_training')
└── status ('pending' | 'paid' | 'cancelled')
```

## Поток данных

### 1. Запись клиента на естественный склон
```
Клиент → Бот → Выбор тренера → Просмотр расписания → Запись → 
Начисление бонуса → Создание тренировки → Уведомление тренера
```

### 2. Создание тренировки тренером
```
Тренер → Тренерская панель → Установка расписания → Создание тренировки → 
Уведомление клиентов → Запись клиентов → Начисление бонусов
```

### 3. Система защиты тренеров
```
Клиент записывается → Деньги списываются → Тренировка проводится → 
Тренер получает выплату (независимо от явки клиента)
```

## Ключевые особенности

### Минимальные изменения
- Переиспользование существующих таблиц `clients`, `children`, `wallets`
- Расширение `training_sessions` одним полем `slope_type`
- Добавление `trainer_id` в `schedule` (опционально)

### Система бонусов
- Гибкое управление через админ-панель
- Раздельные настройки для тренажера и естественного склона
- Автоматическое начисление при записи

### Защита тренеров
- Деньги списываются при записи
- Тренер получает выплату независимо от явки клиента
- Система отслеживания выплат

### Тренерская панель
- Веб-интерфейс для управления расписанием
- Создание групповых и индивидуальных тренировок
- Просмотр записей клиентов

