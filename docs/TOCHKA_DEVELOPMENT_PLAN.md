# üõ†Ô∏è –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¢–æ—á–∫–∞ –ë–∞–Ω–∫–æ–º

**–î–∞—Ç–∞:** 8 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** üìã –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ  
**–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Å—Ä–æ–∫:** 1-2 –Ω–µ–¥–µ–ª–∏

---

## üìä –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π](#1-–æ–±–∑–æ—Ä-–∏–∑–º–µ–Ω–µ–Ω–∏–π)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#2-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
3. [–≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏](#3-—ç—Ç–∞–ø-1-—Å–æ–∑–¥–∞–Ω–∏–µ-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏)
4. [–≠—Ç–∞–ø 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¢–∏–Ω—å–∫–æ—Ñ—Ñ](#4-—ç—Ç–∞–ø-2-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-—Ç–∏–Ω—å–∫–æ—Ñ—Ñ)
5. [–≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞](#5-—ç—Ç–∞–ø-3-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Ç–æ—á–∫–∞-–±–∞–Ω–∫–∞)
6. [–≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î](#6-—ç—Ç–∞–ø-4-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
7. [–≠—Ç–∞–ø 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Routes](#7-—ç—Ç–∞–ø-5-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-routes)
8. [–≠—Ç–∞–ø 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend](#8-—ç—Ç–∞–ø-6-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-frontend)
9. [–≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#9-—ç—Ç–∞–ø-7-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
10. [–ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏](#10-—á–µ–∫-–ª–∏—Å—Ç-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)

---

## 1. –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### üéØ –ß—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ:

1. **–°–æ–∑–¥–∞–Ω–∞ –≥–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π**
   - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π PaymentProvider
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ .env

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Ä—Ç (1% –∫–æ–º–∏—Å—Å–∏—è)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –°–ë–ü (0% –∫–æ–º–∏—Å—Å–∏—è!)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –¢–æ—á–∫–∞ –ß–µ–∫–∏

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î**
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –ª—é–±—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI**
   - –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã (–ö–∞—Ä—Ç–∞ / –°–ë–ü)
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ QR-–∫–æ–¥–∞ –¥–ª—è –°–ë–ü

5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –°—Ç–∞—Ä—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

```
src/services/payment/
‚îú‚îÄ‚îÄ paymentProvider.js          # Factory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ tinkoffProvider.js      # –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ tochkaProvider.js      # –ù–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ mockProvider.js        # –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ signatureHelper.js      # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π
    ‚îî‚îÄ‚îÄ receiptBuilder.js       # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤ (54-–§–ó)
```

### üìù –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:

```
src/routes/
‚îú‚îÄ‚îÄ kuliga-booking.js           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ paymentMethod
‚îî‚îÄ‚îÄ kuliga-payment.js           # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π webhook handler

src/db/migrations/
‚îî‚îÄ‚îÄ XXX_add_payment_provider_fields.sql  # –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

public/js/
‚îî‚îÄ‚îÄ kuliga-booking.js           # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã

.env                              # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
```

---

## 3. –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

### üìã –ó–∞–¥–∞—á–∏:

#### 3.1 –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å PaymentProvider

**–§–∞–π–ª:** `src/services/payment/paymentProvider.js`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- Factory pattern –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏–∑ .env
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ webhook payload

**–ö–æ–¥:**
```javascript
class PaymentProviderFactory {
  static create(providerName = null) {
    const provider = providerName || process.env.PAYMENT_PROVIDER || 'tinkoff';
    // ...
  }
  
  static detectProviderFromWebhook(payload) {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ payload
  }
}
```

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

---

#### 3.2 –°–æ–∑–¥–∞—Ç—å MockProvider –¥–ª—è —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª:** `src/services/payment/providers/mockProvider.js`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ò–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –î–ª—è unit-—Ç–µ—Å—Ç–æ–≤
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö API –≤—ã–∑–æ–≤–æ–≤

**–í—Ä–µ–º—è:** 1 —á–∞—Å

---

## 4. –≠—Ç–∞–ø 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¢–∏–Ω—å–∫–æ—Ñ—Ñ

### üìã –ó–∞–¥–∞—á–∏:

#### 4.1 –í—ã–Ω–µ—Å—Ç–∏ —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –≤ TinkoffProvider

**–§–∞–π–ª:** `src/services/payment/providers/tinkoffProvider.js`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ–Ω–æ—Å –ª–æ–≥–∏–∫–∏ –∏–∑ `kuligaPaymentService.js`
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ PaymentProvider
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ–π —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–ú–µ—Ç–æ–¥—ã:**
- `initPayment()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `verifyWebhookSignature()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ Token
- `parseWebhookData()` - –ø–∞—Ä—Å–∏–Ω–≥ webhook
- `checkPaymentStatus()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `refundPayment()` - –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

---

#### 4.2 –û–±–Ω–æ–≤–∏—Ç—å kuligaPaymentService.js

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –æ–±–µ—Ä—Ç–∫—É –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –í–Ω—É—Ç—Ä–∏ –≤—ã–∑—ã–≤–∞–µ—Ç TinkoffProvider
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–±—Ä–∞—Ç—å –≤ –±—É–¥—É—â–µ–º

**–í—Ä–µ–º—è:** 1 —á–∞—Å

---

## 5. –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞

### üìã –ó–∞–¥–∞—á–∏:

#### 5.1 –°–æ–∑–¥–∞—Ç—å TochkaProvider

**–§–∞–π–ª:** `src/services/payment/providers/tochkaProvider.js`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ PaymentProvider
- –†–∞–±–æ—Ç–∞ —Å API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Ä—Ç –∏ –°–ë–ü

**–ú–µ—Ç–æ–¥—ã:**

**1. initPayment()**
```javascript
async initPayment({
  orderId,
  amount,
  description,
  customerPhone,
  customerEmail,
  items,
  paymentMethod = 'card' // 'card' | 'sbp'
}) {
  // POST /api/v1/payment-operations
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { paymentId, paymentURL, qrCodeUrl }
}
```

**2. verifyWebhookSignature()**
```javascript
verifyWebhookSignature(payload, headers) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ —Å RS256
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
}
```

**3. parseWebhookData()**
```javascript
parseWebhookData(payload) {
  // –ò–∑–≤–ª–µ–∫–∞–µ—Ç: orderId, paymentId, status, amount
}
```

**4. checkPaymentStatus()**
```javascript
async checkPaymentStatus(paymentId) {
  // GET /api/v1/payment-operations/{id}
}
```

**5. refundPayment()**
```javascript
async refundPayment(paymentId, amount) {
  // POST /api/v1/payment-operations/{id}/refund
}
```

**–í—Ä–µ–º—è:** 6-8 —á–∞—Å–æ–≤

---

#### 5.2 –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã

**–§–∞–π–ª:** `src/services/payment/utils/signatureHelper.js`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Å RS256
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HMAC –ø–æ–¥–ø–∏—Å–µ–π
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–ª—é—á–∞–º–∏

**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞

---

#### 5.3 –°–æ–∑–¥–∞—Ç—å receiptBuilder

**–§–∞–π–ª:** `src/services/payment/utils/receiptBuilder.js`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤ –¥–ª—è 54-–§–ó
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è

**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞

---

## 6. –≠—Ç–∞–ø 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üìã –ó–∞–¥–∞—á–∏:

#### 6.1 –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

**–§–∞–π–ª:** `src/db/migrations/XXX_add_payment_provider_fields.sql`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ `kuliga_transactions`
- –ú–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã

**SQL:**
```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è
ALTER TABLE kuliga_transactions
  ADD COLUMN payment_provider VARCHAR(50) DEFAULT 'tinkoff',
  ADD COLUMN provider_payment_id VARCHAR(255),
  ADD COLUMN provider_order_id VARCHAR(255),
  ADD COLUMN provider_status VARCHAR(100),
  ADD COLUMN payment_method VARCHAR(50),
  ADD COLUMN provider_raw_data JSONB;

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_transactions_provider_payment_id 
  ON kuliga_transactions(provider_payment_id);
CREATE INDEX idx_transactions_payment_provider 
  ON kuliga_transactions(payment_provider);

-- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
UPDATE kuliga_transactions SET
  payment_provider = 'tinkoff',
  provider_payment_id = tinkoff_payment_id,
  provider_order_id = tinkoff_order_id,
  provider_status = tinkoff_status,
  payment_method = 'card'
WHERE tinkoff_payment_id IS NOT NULL;
```

**–í—Ä–µ–º—è:** 1 —á–∞—Å (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞) + 5 –º–∏–Ω—É—Ç (–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ)

---

## 7. –≠—Ç–∞–ø 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Routes

### üìã –ó–∞–¥–∞—á–∏:

#### 7.1 –û–±–Ω–æ–≤–∏—Ç—å kuliga-booking.js

**–ß—Ç–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è:**

**1. –ò–º–ø–æ—Ä—Ç—ã:**
```javascript
// –ë—ã–ª–æ:
const { initPayment } = require('../services/kuligaPaymentService');

// –°—Ç–∞–ª–æ:
const PaymentProviderFactory = require('../services/payment/paymentProvider');
```

**2. createIndividualBooking():**
```javascript
// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É paymentMethod
const { paymentMethod = 'card' } = req.body;

// –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä
const provider = PaymentProviderFactory.create();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–ª–∞—Ç–µ–∂
const payment = await provider.initPayment({
  orderId: `kuliga-${bookingId}`,
  amount: totalPrice,
  description,
  customerPhone: normalizedPhone,
  customerEmail: email?.trim(),
  items: [...],
  paymentMethod // 'card' –∏–ª–∏ 'sbp'
});

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
await pool.query(`
  UPDATE kuliga_transactions
  SET payment_provider = $1,
      provider_payment_id = $2,
      provider_order_id = $3,
      provider_status = $4,
      payment_method = $5,
      provider_raw_data = $6
  WHERE id = $7
`, [
  process.env.PAYMENT_PROVIDER || 'tochka',
  payment.paymentId,
  `kuliga-${bookingId}`,
  payment.status,
  paymentMethod,
  JSON.stringify(payment),
  transactionId
]);

// –í–æ–∑–≤—Ä–∞—â–∞–µ–º URL (–∏–ª–∏ QR –¥–ª—è –°–ë–ü)
return res.json({
  success: true,
  bookingId,
  paymentUrl: payment.paymentURL,
  paymentMethod,
  qrCodeUrl: payment.qrCodeUrl // –ï—Å–ª–∏ –°–ë–ü
});
```

**3. createGroupBooking():**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**4. createProgramBooking():**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–í—Ä–µ–º—è:** 4-5 —á–∞—Å–æ–≤

---

#### 7.2 –û–±–Ω–æ–≤–∏—Ç—å kuliga-payment.js (webhook handler)

**–ß—Ç–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è:**

**1. –ò–º–ø–æ—Ä—Ç—ã:**
```javascript
const PaymentProviderFactory = require('../services/payment/paymentProvider');
```

**2. –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook:**
```javascript
router.post('/callback', express.json(), async (req, res) => {
  const payload = req.body || {};
  
  try {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
    const providerName = PaymentProviderFactory.detectProviderFromWebhook(payload);
    const provider = PaymentProviderFactory.create(providerName);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
    if (!provider.verifyWebhookSignature(payload, req.headers)) {
      console.error('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å—å webhook');
      return res.status(400).send('Invalid signature');
    }
    
    // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ
    const webhookData = provider.parseWebhookData(payload);
    const { orderId, paymentId, status, amount, paymentMethod } = webhookData;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ë–î —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
    await client.query(`
      UPDATE kuliga_transactions
      SET provider_status = $1,
          provider_payment_id = $2,
          status = CASE
            WHEN $1 IN ('SUCCESS', 'CONFIRMED') THEN 'completed'
            WHEN $1 IN ('FAILED', 'REJECTED', 'CANCELED') THEN 'failed'
            ELSE status
          END,
          provider_raw_data = $3
      WHERE booking_id = $4
    `, [status, paymentId, JSON.stringify(payload), bookingId]);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    // ...
  }
});
```

**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

---

## 8. –≠—Ç–∞–ø 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend

### üìã –ó–∞–¥–∞—á–∏:

#### 8.1 –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã

**–§–∞–π–ª:** `public/js/kuliga-booking.js`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:**

**1. –§—É–Ω–∫—Ü–∏—è showPaymentMethodModal():**
```javascript
function showPaymentMethodModal(totalAmount) {
  return new Promise((resolve) => {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã: –ö–∞—Ä—Ç–∞ / –°–ë–ü
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
  });
}
```

**2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handleSubmit():**
```javascript
async function handleSubmit(event) {
  // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è ...
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
  const paymentMethod = await showPaymentMethodModal(totalAmount);
  if (!paymentMethod) return;
  
  // –î–æ–±–∞–≤–ª—è–µ–º –≤ payload
  const payload = buildPayload();
  payload.paymentMethod = paymentMethod;
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
  const response = await fetch(API.createBooking, {
    method: 'POST',
    body: JSON.stringify(payload)
  });
  
  const data = await response.json();
  
  // –î–ª—è –°–ë–ü –ø–æ–∫–∞–∑—ã–≤–∞–µ–º QR-–∫–æ–¥
  if (paymentMethod === 'sbp' && data.qrCodeUrl) {
    showSBPQRCode(data.qrCodeUrl, data.paymentUrl);
  } else {
    window.location.href = data.paymentUrl;
  }
}
```

**3. –§—É–Ω–∫—Ü–∏—è showSBPQRCode():**
```javascript
function showSBPQRCode(qrCodeUrl, paymentUrl) {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å QR-–∫–æ–¥–æ–º
  // –ò —Å—Å—ã–ª–∫–æ–π –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±–∞–Ω–∫–∞
}
```

**–í—Ä–µ–º—è:** 4-5 —á–∞—Å–æ–≤

---

#### 8.2 –î–æ–±–∞–≤–∏—Ç—å CSS —Å—Ç–∏–ª–∏

**–§–∞–π–ª:** `public/css/kuliga-booking.css` (–∏–ª–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:**
- –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ –æ–ø–ª–∞—Ç—ã
- –°—Ç–∏–ª–∏ –¥–ª—è QR-–∫–æ–¥–∞
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞

---

## 9. –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üìã –ó–∞–¥–∞—á–∏:

#### 9.1 Unit-—Ç–µ—Å—Ç—ã

**–§–∞–π–ª—ã:**
- `tests/payment/tochkaProvider.test.js`
- `tests/payment/paymentProviderFactory.test.js`
- `tests/payment/signatureHelper.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:**
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–∫–∞—Ä—Ç—ã)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–°–ë–ü)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook
- –ü–∞—Ä—Å–∏–Ω–≥ webhook –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–í—Ä–µ–º—è:** 4-5 —á–∞—Å–æ–≤

---

#### 9.2 Integration-—Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `tests/integration/booking-payment.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:**
- –ü–æ–ª–Ω—ã–π flow –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ–ø–ª–∞—Ç–æ–π
- Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î

**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

---

#### 9.3 E2E —Ç–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª:** `tests/e2e/booking-flow.test.js`

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:**
- –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã
- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–ø–ª–∞—Ç—É

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

---

#### 9.4 –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
1. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–ø–ª–∞—Ç–æ–π –∫–∞—Ä—Ç–æ–π
2. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–ø–ª–∞—Ç–æ–π –°–ë–ü
3. –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
4. –ù–µ—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
5. Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞
6. –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

---

## 10. –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- [x] ‚úÖ –≠–∫–≤–∞–π—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω
- [x] ‚úÖ JWT-–∫–ª—é—á –ø–æ–ª—É—á–µ–Ω
- [x] ‚úÖ Client ID –ø–æ–ª—É—á–µ–Ω
- [x] ‚úÖ Customer Code –Ω–∞–π–¥–µ–Ω
- [x] ‚úÖ Merchant ID –Ω–∞–π–¥–µ–Ω (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)
- [ ] üìÑ –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ –ø–æ–ª—É—á–µ–Ω
- [ ] üîó Webhook URL'—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ –õ–ö
- [ ] üìù .env —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª–µ–Ω

### –ü–æ—Å–ª–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

- [ ] ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] ‚úÖ Unit-—Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
- [ ] ‚úÖ Integration-—Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
- [ ] ‚úÖ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|-------|-----------|
| **1. –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è** | 3-4 —á–∞—Å–∞ | –í—ã—Å–æ–∫–∏–π |
| **2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¢–∏–Ω—å–∫–æ—Ñ—Ñ** | 4-5 —á–∞—Å–æ–≤ | –í—ã—Å–æ–∫–∏–π |
| **3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–æ—á–∫–∞** | 10-12 —á–∞—Å–æ–≤ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| **4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î** | 1 —á–∞—Å | –í—ã—Å–æ–∫–∏–π |
| **5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Routes** | 7-9 —á–∞—Å–æ–≤ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| **6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend** | 6-7 —á–∞—Å–æ–≤ | –í—ã—Å–æ–∫–∏–π |
| **7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | 11-15 —á–∞—Å–æ–≤ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| **–ò–¢–û–ì–û** | **42-53 —á–∞—Å–∞** | **5-7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π** |

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è

### –§–∞–∑–∞ 1: MVP (–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç)

**–¶–µ–ª—å:** –†–∞–±–æ—Ç–∞—é—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ –¢–æ—á–∫–∞ –ë–∞–Ω–∫

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ TochkaProvider (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ kuliga-booking.js
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ webhook handler
4. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
5. ‚úÖ –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–∂–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –∫–∞—Ä—Ç–∞–º–∏

---

### –§–∞–∑–∞ 2: –°–ë–ü –∏ UI

**–¶–µ–ª—å:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –°–ë–ü –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–π UX

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –°–ë–ü –≤ TochkaProvider
2. ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –æ–ø–ª–∞—Ç—ã
3. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ QR-–∫–æ–¥–∞
4. ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –°–ë–ü

---

### –§–∞–∑–∞ 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞

**–¶–µ–ª—å:** –ö–∞—á–µ—Å—Ç–≤–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¢–∏–Ω—å–∫–æ—Ñ—Ñ
2. ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è PaymentProvider
3. ‚úÖ –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í—Ä–µ–º—è:** 1-2 –¥–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Production-ready —Å–∏—Å—Ç–µ–º–∞

---

## üîÑ –ü–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (5-7 –¥–Ω–µ–π)

- –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- –ù–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞
- –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging (2-3 –¥–Ω—è)

- –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API (–º–∞–ª—ã–µ —Å—É–º–º—ã)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤

### –≠—Ç–∞–ø 3: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout (1-2 –Ω–µ–¥–µ–ª–∏)

- 10% —Ç—Ä–∞—Ñ–∏–∫–∞ (Week 1)
- 50% —Ç—Ä–∞—Ñ–∏–∫–∞ (Week 2)
- 100% —Ç—Ä–∞—Ñ–∏–∫–∞ (Week 3)

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ª–µ–≥–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

### –†–∏—Å–∫ 2: –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π JWT –ø–æ–¥–ø–∏—Å–∏

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ü–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∑–∞—Ä–∞–Ω–µ–µ
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –†–∏—Å–∫ 3: –ë–∞–≥–∏ –≤ legacy –∫–æ–¥–µ –¢–∏–Ω—å–∫–æ—Ñ—Ñ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –∫–∞–∫ –µ—Å—Ç—å
- –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Fallback –Ω–∞ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:

1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - API endpoints
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**
   - –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
   - –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã
   - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

3. **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å .env
   - –ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - Troubleshooting

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É, –∫–æ–≥–¥–∞:

- [ ] ‚úÖ –í—Å–µ unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] ‚úÖ –í—Å–µ integration-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] ‚úÖ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤
- [ ] ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [ ] ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚úÖ –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –≥–æ—Ç–æ–≤

---

## üöÄ –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∏–Ω–∞—Ç—å?

**–ö–æ–≥–¥–∞ –≤—Å–µ credentials –ø–æ–ª—É—á–µ–Ω—ã –∏ .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω:**

1. –ù–∞–ø–∏—à–∏—Ç–µ: "–ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!"
2. –Ø –Ω–∞—á–Ω—É —Å –§–∞–∑—ã 1 (MVP)
3. –ë—É–¥–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –ø–æ—ç—Ç–∞–ø–Ω–æ
4. –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

**–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π —Å—Ä–æ–∫:** 5-7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –¥–æ MVP

---

**–í–æ–ø—Ä–æ—Å—ã? –ü–∏—à–∏—Ç–µ! üí¨**

