# Ski Simulator - Система управления тренажерами

## Описание проекта
Система для управления расписанием и бронированием тренажеров для обучения горнолыжному спорту.

## Установка и запуск
1. Установите зависимости:
```bash
npm install
```

2. Создайте файл `.env` с параметрами подключения к базе данных:
```
DB_USER=batl-zlat
DB_HOST=90.156.210.24
DB_NAME=skisimulator
DB_PASSWORD=Nemezida2324%)
DB_PORT=5432
```

3. Запустите сервер:
```bash
node src/app.js
```

## Бот-информер администратора
В системе реализован Telegram-бот для уведомления администратора о важных событиях.

### Настройка бота
1. Найдите бота в Telegram: @GORNOSTYLE_INFO_BOT
2. Отправьте команду `/start` для активации

### Автоматические уведомления
Бот автоматически отправляет уведомления о:
- Создании нового расписания на следующий месяц
- Важных изменениях в системе

### Доступ
Бот доступен только для администратора системы (ID: 546668421).

## Скрипты управления расписанием

### Создание первоначального расписания
Для создания расписания на текущий и следующий месяц используйте скрипт:
```bash
node src/scripts/create-initial-schedule.js
```
Скрипт создаст слоты с 10:00 до 21:00 с интервалом 30 минут для обоих тренажеров.

### Автоматическое создание расписания
Расписание на следующий месяц создается автоматически по расписанию.
Настройки времени можно изменить в файле `src/scripts/create-next-month-schedule.js`:
```javascript
const CRON_SETTINGS = {
    day: 2,    // День месяца
    hour: 15,  // Час
    minute: 10 // Минута
};
```

Для запуска автоматического создания расписания используйте:
```bash
node src/scripts/run-schedule-cron.js
```

Скрипт запустит создание расписания сразу и будет ждать следующего запуска по расписанию.

### Управление расписанием через SQL
Для удаления расписания за определенный период используйте SQL-запрос:
```sql
DELETE FROM schedule WHERE date BETWEEN '2024-05-01' AND '2024-05-31';
```

Для создания расписания на конкретный день:
```sql
INSERT INTO schedule (simulator_id, date, start_time, end_time)
SELECT s.id, '2024-06-30', t.start_time::time, t.end_time::time
FROM simulators s
CROSS JOIN (
    VALUES 
    ('10:00', '10:30'), ('10:30', '11:00'), ('11:00', '11:30'),
    ('11:30', '12:00'), ('12:00', '12:30'), ('12:30', '13:00'),
    ('13:00', '13:30'), ('13:30', '14:00'), ('14:00', '14:30'),
    ('14:30', '15:00'), ('15:00', '15:30'), ('15:30', '16:00'),
    ('16:00', '16:30'), ('16:30', '17:00'), ('17:00', '17:30'),
    ('17:30', '18:00'), ('18:00', '18:30'), ('18:30', '19:00'),
    ('19:00', '19:30'), ('19:30', '20:00'), ('20:00', '20:30'),
    ('20:30', '21:00')
) AS t(start_time, end_time)
WHERE s.id IN (1, 2);
```

## Структура проекта
- `src/` - исходный код сервера
  - `routes/` - маршруты API
  - `scripts/` - скрипты для управления расписанием
  - `db/` - настройки базы данных
  - `bot/` - код Telegram-бота
- `public/` - статические файлы и клиентский код
- `.env` - файл с переменными окружения
- `README.md` - документация проекта 